(function(){$(document).on("pagebeforecreate",function(){var a;null==pimatic.pages.editRule&&(a=function(){function a(){this.ruleAsText=ko.computed(function(a){return function(){return"if "+a.ruleCondition()+" then "+a.ruleActions()}}(this)),this.pageTitle=ko.computed(function(a){return function(){return __("add"===a.action()?"Add new rule":"Edit rule")}}(this))}return a.prototype.autocompleteAjax=null,a.prototype.autocompleEnabled=!0,a.prototype.action=ko.observable("add"),a.prototype.ruleId=ko.observable(""),a.prototype.ruleName=ko.observable(""),a.prototype.ruleCondition=ko.observable(""),a.prototype.ruleActions=ko.observable(""),a.prototype.ruleEnabled=ko.observable(!0),a.prototype.resetFields=function(){return this.ruleId(""),this.ruleName(""),this.ruleCondition(""),this.ruleActions(""),this.ruleEnabled(!0)},a.prototype.onSubmit=function(){return $.post("/api/rule/"+this.ruleId()+"/"+this.action(),{rule:this.ruleAsText(),active:this.ruleEnabled(),name:this.ruleName()}).done(function(a){return a.success?$.mobile.changePage("#index",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a.prototype.onRemove=function(){return $.get("/api/rule/"+this.ruleId()+"/remove").done(function(a){return a.success?$.mobile.changePage("#index",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a}(),pimatic.pages.editRule=new a)}),$(document).on("pagecreate","#edit-rule",function(){var a,b,c;return ko.applyBindings(pimatic.pages.editRule,$("#edit-rule")[0]),a=function(a,b){var c;return c=this.ac.getCommonPart(a,b),a.substring(0,a.length-c.length)+b},b=function(a){var b,c;return b=this.ac.getCommonPart(this.lastTerm,a),c=a.substring(b.length,a.length),"<strong>"+b+"</strong>"+c},c=pimatic.pages.editRule,$("#edit-rule-condition").textcomplete([{match:/^(.*)$/,search:function(a,b){var d;return null!=(d=c.autocompleteAjax)&&d.abort(),pimatic.pages.editRule.autocompleEnabled?c.autocompleteAjax=$.ajax("parseCondition",{type:"POST",data:{condition:a},global:!1}).done(function(c){return function(d){var e,f;return e=(null!=(f=d.context)?f.autocomplete:void 0)||[],d.error&&console.log(d.error),c.lastTerm=a,b(e)}}(this)).fail(function(){return function(){return b([])}}(this)):b([])},index:1,replace:function(b,d){var e;return e=a.call(this,b,d),c.ruleCondition(e),e},template:b}]),$("#edit-rule-actions").textcomplete([{match:/^(.*)$/,search:function(a,b){var d;return pimatic.pages.editRule.autocompleEnabled?(null!=(d=c.autocompleteAjax)&&d.abort(),c.autocompleteAjax=$.ajax("parseActions",{type:"POST",data:{action:a},global:!1}).done(function(c){return function(d){var e,f;return e=(null!=(f=d.context)?f.autocomplete:void 0)||[],null!=d.message&&d.message.length>0&&pimatic.showToast(d.message[0]),d.error&&console.log(d.error),c.lastTerm=a,b(e)}}(this)).fail(function(){return function(){return b([])}}(this))):b([])},index:1,replace:function(b,d){var e;return e=a.call(this,b,d),c.ruleActions(e),e},template:b}])}),$(document).on("pagebeforehide","#edit-rule",function(){var a;return null!=(a=pimatic.pages.editRule.autocompleteAjax)?a.abort():void 0})}).call(this);