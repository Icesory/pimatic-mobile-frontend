(function(){var a,b,c,d;d=pimatic.tryCatch,b=function(){function a(a){this.id=a.id,this.name=ko.observable(a.name),this.isAdded=ko.computed(function(a){return function(){var b,c;return b=pimatic.pages.index.items(),c=ko.utils.arrayFirst(b,function(b){return"device"===b.type&&b.deviceId===a.id}),null!=c}}(this)),this.icon=ko.computed(function(a){return function(){return a.isAdded()?"check":"plus"}}(this))}return a.prototype.update=function(a){return this.name(a.name)},a}(),c=function(){function a(a){this.name=a.name,this.isAdded=ko.computed(function(a){return function(){var b,c;return b=pimatic.pages.index.items(),c=ko.utils.arrayFirst(b,function(b){return"variable"===b.type&&b.name===a.name}),null!=c}}(this)),this.icon=ko.computed(function(a){return function(){return a.isAdded()?"check":"plus"}}(this))}return a.prototype.update=function(a){return this.name=a.name},a}(),a=function(){function a(){this.refreshDeviceListView=ko.computed(function(a){return function(){return a.devices(),$("#device-items").listview("refresh")}}(this)).extend({rateLimit:{timeout:10,method:"notifyWhenChangesStop"}}),this.refreshVariableListView=ko.computed(function(a){return function(){return a.variables(),$("#variable-items").listview("refresh")}}(this)).extend({rateLimit:{timeout:10,method:"notifyWhenChangesStop"}})}return a.prototype.devices=ko.observableArray([]),a.prototype.variables=ko.observableArray([]),a.prototype.updateDevicesFromJs=function(a){var c;return c={create:function(){return function(a){var c,d,e;return c=a.data,d=a.parent,e=a.skip,new b(c)}}(this),update:function(){return function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d}}(this),key:function(){return function(a){return a.id}}(this)},ko.mapping.fromJS(a,c,this.devices)},a.prototype.updateVariablesFromJs=function(a){var b;return b={create:function(){return function(a){var b,d,e;return b=a.data,d=a.parent,e=a.skip,new c(b)}}(this),update:function(){return function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d}}(this),key:function(){return function(a){return a.name}}(this)},ko.mapping.fromJS(a,b,this.variables)},a.prototype.addDeviceToIndexPage=function(a){return a.isAdded()?void 0:$.get("/add-device/"+a.id).done(ajaxShowToast).fail(ajaxAlertFail)},a.prototype.addVariableToIndexPage=function(a){return a.isAdded()?void 0:$.get("/add-variable/"+a.name).done(ajaxShowToast).fail(ajaxAlertFail)},a}(),d(function(){return function(){return pimatic.pages.addItem=new a}}(this)),$(document).on("pagecreate","#add-item",d(function(){ko.applyBindings(pimatic.pages.addItem,$("#add-item")[0]),$("#device-items").on("click","li.item",d(function(){var a;a=$(this),pimatic.pages.addItem.addDeviceToIndexPage(ko.dataFor(a[0]))})),$("#variable-items").on("click","li.item",d(function(){var a;a=$(this),pimatic.pages.addItem.addVariableToIndexPage(ko.dataFor(a[0]))})),$("#add-other").on("click","#add-a-header",d(function(){$("<div>").simpledialog2({themeDialog:"a",themeButtonDefault:"b",mode:"button",headerText:__("Name"),headerClose:!0,buttonPrompt:__("Please enter a name"),buttonInput:!0,buttons:{OK:{text:__("Add"),click:function(){var a;return a=$.mobile.sdLastInput,""===a?pimatic.showToast(__("Please enter a name")):$.get("/add-header/"+a).done(function(){return pimatic.showToast(__("Header added"))}).fail(ajaxAlertFail)}}}}),setTimeout(function(){return $(".ui-simpledialog-input").focus()},1)})),$("#add-other").on("click","#add-a-button",d(function(){$("<div>").simpledialog2({themeDialog:"a",themeButtonDefault:"b",mode:"button",headerText:__("Name"),headerClose:!0,buttonPrompt:__("Please enter a name"),buttonInput:!0,buttons:{OK:{text:__("Add"),click:function(){var a;return a=$.mobile.sdLastInput,""===a?pimatic.showToast(__("Please enter a name")):$.get("/add-button/"+a).done(function(){return pimatic.showToast(__("Button added"))}).fail(ajaxAlertFail)}}}}),setTimeout(function(){return $(".ui-simpledialog-input").focus()},1)}))})),$(document).on("pageshow","#add-item",d(function(){$.get("/api/devices").done(d(function(a){return pimatic.pages.addItem.updateDevicesFromJs(a.devices)})).fail(ajaxAlertFail),$.get("/api/variables").done(d(function(a){return pimatic.pages.addItem.updateVariablesFromJs(a.variables)})).fail(ajaxAlertFail)}))}).call(this);