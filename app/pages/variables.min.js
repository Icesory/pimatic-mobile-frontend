(function(){var a;a=pimatic.tryCatch,$(document).on("pagebeforecreate","#variables-page",a(function(){var b,c;return b=function(){function b(){this.variables=pimatic.variables,this.variablesListViewRefresh=ko.computed(a(function(a){return function(){return a.variables(),a.enabledEditing(),pimatic["try"](function(){return $("#variables").listview("refresh").addClass("dark-background")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.lockButton=ko.computed(a(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this))),this.visibleVars=ko.computed(a(function(a){return function(){return ko.utils.arrayFilter(a.variables(),function(b){return a.showAttributeVars()||!b.isDeviceAttribute()})}}(this)))}return b.prototype.enabledEditing=ko.observable(!1),b.prototype.ruleItemCssClass=ko.observable(""),b.prototype.isSortingVariables=ko.observable(!1),b.prototype.showAttributeVars=ko.observable(!1),b.prototype.afterRenderVariable=function(){},b.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing()),pimatic.loading("enableediting","show",{text:__("Saving")}),$.ajax("/enabledEditing/"+this.enabledEditing(),{global:!1}).always(function(){return pimatic.loading("enableediting","hide")}).done(ajaxShowToast)},b.prototype.onVariablesSorted=function(){var a,b;return a=function(){var a,c,d,e;for(d=this.variables(),e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b.name);return e}.call(this),pimatic.loading("variableorder","show",{text:__("Saving")}),$.ajax("update-variable-order",{type:"POST",global:!1,data:{order:a}}).always(function(){return pimatic.loading("variableorder","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)},b.prototype.onDropVariableOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete variable: %s?","$"+a.name)),c?(b=function(b){return function(){return pimatic.loading("deletevariable","show",{text:__("Saving")}),$.get("/api/variable/"+a.name+"/remove").done(function(c){return c.success?b.variables.remove(a):void 0}).always(function(){return pimatic.loading("deletevariable","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},b.prototype.onAddVariableClicked=function(){var a;return a=pimatic.pages.editVariable,a.resetFields(),a.action("add"),!0},b.prototype.onEditVariableClicked=function(a){var b;return a.isDeviceAttribute()?!1:(b=pimatic.pages.editVariable,b.variableName(a.name),b.variableValue("value"===a.type()?a.value():a.exprInputStr()),b.variableType(a.type()),b.action("update"),!0)},b.prototype.toggleShowAttributeVars=function(){return this.showAttributeVars(!this.showAttributeVars()),pimatic.loading("showAttributeVars","show",{text:__("Saving")}),$.ajax("/showAttributeVars/"+this.showAttributeVars(),{global:!1}).always(function(){return pimatic.loading("showAttributeVars","hide")}).done(ajaxShowToast)},b}(),pimatic.pages.variables=c=new b})),$(document).on("pagecreate","#variables-page",a(function(){var a,b,c;b=pimatic.pages.variables;try{ko.applyBindings(b,$("#variables-page")[0])}catch(d){a=d,TraceKit.report(a),null!=(c=pimatic.storage)&&c.removeAll(),window.location.reload()}$("#variables .handle").disableSelection()})),$(document).on("pagebeforeshow","#variables-page",a(function(){return pimatic["try"](function(){return function(){return $("#variables").listview("refresh").addClass("dark-background")}}(this))}))}).call(this);