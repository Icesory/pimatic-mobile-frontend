(function(){var a;a=pimatic.tryCatch,$(document).on("pagebeforecreate","#rules-page",a(function(){var b,c;return b=function(){function b(){this.rules=pimatic.rules,this.rulesListViewRefresh=ko.computed(a(function(a){return function(){return a.rules(),a.isSortingRules(),a.enabledEditing(),pimatic["try"](function(){return $("#rules").listview("refresh").addClass("dark-background")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.lockButton=ko.computed(a(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this)))}return b.prototype.enabledEditing=ko.observable(!1),b.prototype.ruleItemCssClass=ko.observable(""),b.prototype.isSortingRules=ko.observable(!1),b.prototype.afterRenderRule=function(a){var b;return b=$("#sortable-handle-template").text(),$(a).find("a").before($(b))},b.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing()),pimatic.loading("enableediting","show",{text:__("Saving")}),$.ajax("/enabledEditing/"+this.enabledEditing(),{global:!1}).always(function(){return pimatic.loading("enableediting","hide")}).done(ajaxShowToast)},b.prototype.onRulesSorted=function(){var a,b;return a=function(){var a,c,d,e;for(d=this.rules(),e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b.id);return e}.call(this),pimatic.loading("ruleorder","show",{text:__("Saving")}),$.ajax("update-rule-order",{type:"POST",global:!1,data:{order:a}}).always(function(){return pimatic.loading("ruleorder","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)},b.prototype.onDropRuleOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete the %s rule?",a.name())),c?(b=function(b){return function(){return pimatic.loading("deleterule","show",{text:__("Saving")}),pimatic.client.rest.removeRule({ruleId:b.rule.id}).done(function(c){return c.success?b.rules.remove(a):void 0}).always(function(){return pimatic.loading("deleterule","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},b.prototype.onAddRuleClicked=function(){var a;return a=pimatic.pages.editRule,a.resetFields(),a.action("add"),a.ruleEnabled(!0),!0},b.prototype.onEditRuleClicked=function(a){var b;return b=pimatic.pages.editRule,b.action("update"),b.ruleId(a.id),b.ruleName(a.name()),b.ruleCondition(a.conditionToken()),b.ruleActions(a.actionsToken()),b.ruleEnabled(a.active()),b.ruleLogging(a.logging()),!0},b}(),pimatic.pages.rules=c=new b})),$(document).on("pagecreate","#rules-page",a(function(){var a,b,c;b=pimatic.pages.rules;try{ko.applyBindings(b,$("#rules-page")[0])}catch(d){a=d,TraceKit.report(a),null!=(c=pimatic.storage)&&c.removeAll(),window.location.reload()}$("#rules .handle").disableSelection()})),$(document).on("pagebeforeshow","#rules-page",a(function(){return pimatic["try"](function(){return function(){return $("#rules").listview("refresh").addClass("dark-background")}}(this))}))}).call(this);