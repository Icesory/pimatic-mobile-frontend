(function(){var a;a=pimatic.tryCatch,$(document).on("pagecreate","#log",a(function(){var b,c,d;b=function(){function b(){this.listViewRequest=ko.computed(function(a){return function(){return a.messages(),$("#log-messages").listview("refresh")}}(this)).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}})}return b.mapping={messages:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,b},key:function(a){return a.id}},ignore:["success"]},b.prototype.messages=ko.observableArray([]),b.prototype.updateFromJs=function(a){return ko.mapping.fromJS(a,b.mapping,this)},b.prototype.timestampToDateTime=function(a){var b,c,d;return d=function(){return function(a){return 10>a?"0"+a:""+a}}(this),b=new Date(a),c=d(b.getDate())+"."+d(b.getMonth()+1)+"."+b.getFullYear(),a=d(b.getHours())+":"+d(b.getMinutes())+":"+d(b.getSeconds()),{date:c,time:a}},b.prototype.timeToShow=function(a){var b,c,d,e,f,g,h,i,j;return a=a(),e=this.messages(),0===a?(f=e[a],null==f?"":(d=this.timestampToDateTime(null!=f?f.time:void 0),""+d.date+" "+d.time)):(i=[e[a-1],e[a]],g=i[0],h=i[1],j=[this.timestampToDateTime(g.time),this.timestampToDateTime(h.time)],b=j[0],c=j[1],c.date===b.date?c.time:""+c.date+" "+c.time)},b.prototype.loadMessages=function(){return pimatic.loading("loading message","show",{text:__("Loading Messages")}),$.ajax("/api/messages",{global:!1}).always(function(){return pimatic.loading("loading message","hide")}).done(a(function(a){return a.success?d.updateFromJs(a):void 0})).fail(ajaxAlertFail)},b}();try{pimatic.pages.log=d=new b,pimatic.socket.on("log",a(function(a){return d.messages.push(a)})),$("#log").on("click","#clear-log",a(function(){return $.get("/clear-log").done(a(function(){return d.messages.removeAll(),pimatic.pages.index.errorCount(0)})).fail(ajaxAlertFail)})),ko.applyBindings(d,$("#log")[0])}catch(e){c=e,TraceKit.report(c)}})),$(document).on("pagebeforeshow","#log",a(function(){var a;try{return pimatic.pages.log.loadMessages()}catch(b){return a=b,TraceKit.report(a)}}))}).call(this);