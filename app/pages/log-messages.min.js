(function(){var a;a=pimatic.tryCatch,$(document).on("pagecreate","#log",a(function(){var b,c,d;b=function(){function b(){this.listViewRequest=ko.computed(function(a){return function(){return a.messages(),$("#log-messages").listview("refresh")}}(this)).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}})}return b.mapping={messages:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,b},key:function(a){return a.id}},ignore:["success"]},b.prototype.messages=ko.observableArray([]),b.prototype.updateFromJs=function(a){return ko.mapping.fromJS(a,b.mapping,this)},b.prototype.timeToShow=function(a){var b,c,d,e,f,g,h,i,j,k;return d=function(a){return a.substring(0,10)},e=function(a){return a.substring(11,19)},a=a(),f=this.messages(),0===a?(g=f[a],null!=g?g.time:void 0):(j=[f[a-1],f[a]],h=j[0],i=j[1],k=[d(h.time),d(i.time)],b=k[0],c=k[1],c===b?e(i.time):i.time)},b.prototype.loadMessages=function(){return pimatic.loading("loading message","show",{text:__("Loading Messages")}),$.ajax("/api/messages",{global:!1}).always(function(){return pimatic.loading("loading message","hide")}).done(a(function(a){return a.success?d.updateFromJs(a):void 0})).fail(ajaxAlertFail)},b}();try{pimatic.pages.log=d=new b,pimatic.socket.on("log",a(function(a){return d.messages.push(a)})),$("#log").on("click","#clear-log",a(function(){return $.get("/clear-log").done(a(function(){return d.messages.removeAll(),pimatic.pages.index.errorCount(0)})).fail(ajaxAlertFail)})),ko.applyBindings(d,$("#log")[0])}catch(e){c=e,TraceKit.report(c)}})),$(document).on("pagebeforeshow","#log",a(function(){var a;try{return pimatic.pages.log.loadMessages()}catch(b){return a=b,TraceKit.report(a)}}))}).call(this);