(function(){$(document).on("pagecreate","#log",function(){var a,b;a=function(){function a(){this.listViewRequest=ko.computed(function(a){return function(){return a.messages(),$("#log-messages").listview("refresh")}}(this)).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}})}return a.mapping={messages:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,b},key:function(a){return a.id}},ignore:["success"]},a.prototype.messages=ko.observableArray([]),a.prototype.updateFromJs=function(b){return ko.mapping.fromJS(b,a.mapping,this)},a.prototype.timeToShow=function(a){var b,c,d,e,f,g,h,i,j,k;return d=function(a){return a.substring(0,10)},e=function(a){return a.substring(11,19)},a=a(),f=this.messages(),0===a?(g=f[a],null!=g?g.time:void 0):(j=[f[a-1],f[a]],h=j[0],i=j[1],k=[d(h.time),d(i.time)],b=k[0],c=k[1],c===b?e(i.time):i.time)},a.prototype.loadMessages=function(){return pimatic.loading("loading message","show",{text:__("Loading Messages")}),$.ajax("/api/messages",{global:!1}).always(function(){return pimatic.loading("loading message","hide")}).done(function(a){return a.success?b.updateFromJs(a):void 0}).fail(ajaxAlertFail)},a}(),pimatic.pages.log=b=new a,pimatic.socket.on("log",function(a){return b.messages.push(a)}),$("#log").on("click","#clear-log",function(){return $.get("/clear-log").done(function(){return b.messages.removeAll(),pimatic.pages.index.errorCount(0)}).fail(ajaxAlertFail)}),ko.applyBindings(b,$("#log")[0])}),$(document).on("pagebeforeshow","#log",function(){return pimatic.pages.log.loadMessages()})}).call(this);