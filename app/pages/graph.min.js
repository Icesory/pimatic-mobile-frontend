(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=pimatic.tryCatch,$(document).on("pagecreate","#index",function(){return $("#index").on("click","#item-lists li.item .attributes.contains-attr-type-number",function(){var a,b;return a=null!=(b=ko.dataFor($(this).parent(".item")[0]))?b.device:void 0,console.log(a),jQuery.mobile.pageParams={device:a},jQuery.mobile.changePage("#graph-page",{transition:"slide"})})}),$(document).on("pagecreate","#graph-page",function(){var d,e;return Highcharts.setOptions({global:{useUTC:!1}}),d=function(){function d(){this.afterRenderAttribute=b(this.afterRenderAttribute,this),ko.computed(a(function(a){return function(){var b,c,d,e;if(!a.pageCreated())return!1;for(e=pimatic.groups(),c=0,d=e.length;d>c;c++)b=e[c],b.devices();return pimatic["try"](function(){return $("#graph-device-list").listview("refresh")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),ko.computed(a(function(a){return function(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(e=a.displayedAttributes(),null!=(q=$("#chart").highcharts())&&q.destroy(),0===e.length)return void $("#chart").hide();for(h=a.chosenRange(),k=[],m=0,o=e.length;o>m;m++)g=e[m],r=g.attribute.unit,c.call(k,r)<0&&k.push(g.attribute.unit);switch(l=function(){var a,b,c;for(c=[],a=0,b=k.length;b>a;a++)j=k[a],c.push({labels:{format:"{value} "+j},unit:j,tooltip:{valueDecimals:2,valueSuffix:" "+j},opposite:!1});return c}(),i=new Date,f=new Date,h){case"day":f.setDate(i.getDate()-1);break;case"week":f.setDate(i.getDate()-7);break;case"month":f.setDate(i.getDate()-30);break;case"year":f.setDate(i.getDate()-365)}for(d={tooltip:{valueDecimals:2},yAxis:l,rangeSelector:{enabled:!1},credits:{enabled:!1},series:[],chart:{events:{load:function(){}}}},b=$("#chart").highcharts("StockChart",d),b.show(),b=b.highcharts(),a._graph_reflow_timeout=setTimeout(function(){return pimatic["try"](function(){return b.reflow()})},500),s=[],n=0,p=e.length;p>n;n++)g=e[n],s.push(function(a){return pimatic.client.rest.querySingleDeviceAttributeEvents({deviceId:a.device.id,attributeName:a.attribute.name,criteria:{after:f.getTime(),before:i.getTime()}}).done(function(c){var d,e,f,g,h;return c.success?(d=function(){var a,b,d,e,h;for(d=c.events,h=[],a=0,b=d.length;b>a;a++)e=d[a],f=e.time,g=e.value,h.push([f,g]);return h}(),h=ko.utils.arrayIndexOf(k,a.attribute.unit),e=b.addSeries({name:""+a.device.name()+": "+a.attribute.label,data:d,yAxis:h,tooltip:{valueDecimals:2,valueSuffix:" "+a.attribute.unit}}),a.serie({index:e.index,color:e.color})):void 0})}(g));return s}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}})}var e,f;return d.prototype.groups=pimatic.groups,d.prototype.displayedAttributes=ko.observableArray(),d.prototype.dateFrom=ko.observable(),d.prototype.dateTo=ko.observable(),d.prototype.chosenRange=ko.observable("day"),d.prototype.pageCreated=ko.observable(!1),d.prototype.getUngroupedDevicesWithNumericAttribute=function(){var a,b;return b=pimatic.getUngroupedDevices(),function(){var c,d,e;for(e=[],c=0,d=b.length;d>c;c++)a=b[c],a.hasAttibuteWith(function(){return function(a){return"number"===a.type}}(this))&&e.push(a);return e}.call(this)},d.prototype.afterRenderAttribute=function(a){var b;return b=$(a).find("select"),pimatic["try"](function(){return function(){return b.flipswitch()}}(this))},d.prototype.getDisplayedAttribute=function(a,b){var c,d,e,f;for(console.log(a,b),f=this.displayedAttributes(),d=0,e=f.length;e>d;d++)if(c=f[d],c.device===a&&c.attribute===b)return c;return null},d.prototype.addToDisplayedAttributes=function(a,b){return null==this.getDisplayedAttribute(a,b)?this.displayedAttributes.push({device:a,attribute:b,serie:ko.observable()}):void 0},d.prototype.removeFromDisplayedAttributes=function(a,b){return this.displayedAttributes.remove(function(){return function(c){return c.device===a&&c.attribute===b}}(this))},e=function(a){null==a&&(a="day")},f=function(a,b,c){null==c&&(c="day")},d}(),pimatic.pages.graph=e=new d,ko.applyBindings(e,$("#graph-page")[0]),e.pageCreated(!0),$("#graph-page").on("click",".device-attribute-list .show-button",a(function(){var a,b;a=ko.dataFor(this),b=ko.dataFor($(this).parents(".graph-device")[0]),e.addToDisplayedAttributes(b,a)})),$("#graph-page").on("click",".device-attribute-list .hide-button",a(function(){var a,b;a=ko.dataFor(this),b=ko.dataFor($(this).parents(".graph-device")[0]),e.removeFromDisplayedAttributes(b,a)}))}),$(document).on("pagebeforeshow","#graph-page",function(){var a,b,c,d,e,f,g;if(b=null!=(e=jQuery.mobile.pageParams)?e.device:void 0,jQuery.mobile.pageParams={},null!=b){for(f=b.attributes(),g=[],c=0,d=f.length;d>c;c++)a=f[c],g.push("number"===a.type?pimatic.pages.graph.addToDisplayedAttributes(b,a):void 0);return g}})}).call(this);