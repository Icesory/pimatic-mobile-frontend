(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};$(document).on("pagecreate","#config",function(){var b,c,d;b=function(){function b(){this.updateConfigClicked=a(this.updateConfigClicked,this);var b,c,d;c=this,b=$($("#editor-scripts-template").text()),b.appendTo("head"),d=$(b[1]).attr("src"),$.getScript(d,function(a){return function(){var b,d;return b=$("#config-editor")[0],d=JSONEditor.prototype.setMode,JSONEditor.prototype.setMode=function(a){var b;return b=d.call(this,a),c.mode(a),b},ko.computed(function(){var b,c,d,e,f,g;return b=a.mode(),"code"===b&&(null!=(c=a.editor)&&c.editor.setReadOnly(a.locked()),a.locked()?$("#config-editor .ace_content").addClass("readonly"):$("#config-editor .ace_content").removeClass("readonly")),"view"===b&&(null!=(d=a.editor)&&(d.modes=["tree","code"]),a.locked()||null!=(e=a.editor)&&e.setMode("tree")),"tree"===b&&(null!=(f=a.editor)&&(f.modes=["view","code"]),a.locked())&&null!=(g=a.editor)?g.setMode("view"):void 0}),a.editor=new JSONEditor(b,{mode:"view",modes:["view","code"]}),a.getConfig(),a.config.subscribe(function(b){return a.editor.set(b)})}}(this)),this.lockButton=ko.computed(function(a){return function(){var b;return b=a.locked(),{icon:b?"gear":"delete",text:__(b?"Edit":"Cancel")}}}(this)),$.mobile.document.on("pagebeforechange",function(a){return function(b,c){var d;return(null!=(d=c.options.fromPage)?d.is("#config"):void 0)&&!a.locked()?(swal({title:"Discard all changes?",text:"If you leave the page all unsaved changes will be lost, continue?",type:"warning",showCancelButton:!0,confirmButtonText:"Continue",closeOnConfirm:!0},function(){return a.locked(!0),$.mobile.pageContainer.pagecontainer("change",c.toPage,{options:c.options})}),b.preventDefault(),!1):!0}}(this))}return b.prototype.config=ko.observable(""),b.prototype.mode=ko.observable(""),b.prototype.locked=ko.observable(!0),b.prototype.toggleLock=function(){return this.locked()?swal({type:"prompt",title:"Unlock",text:"Please Enter your password to unlock the config page:",promptPlaceholder:"Password",promptDefaultValue:"",promptInputType:"password"},function(a){return function(b){return pimatic.client.rest.getConfig({password:b}).done(function(b){a.config(b.config),a.locked(!1)}).fail(ajaxAlertFail)}}(this)):pimatic.client.rest.getConfig({}).done(function(a){return function(b){a.config(b.config),a.locked(!0)}}(this)).fail(ajaxAlertFail)},b.prototype.getConfig=function(){return pimatic.client.rest.getConfig({}).done(function(a){return function(b){a.config(b.config)}}(this)).fail(ajaxAlertFail)},b.prototype.updateConfigClicked=function(){return swal({title:"Are you sure?",text:"pimatic will be restarted after the config was changed!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes",closeOnConfirm:!1},function(a){return function(){var b,c;try{return b=a.editor.get(),pimatic.client.rest.updateConfig({config:b}).done(function(){return swal("Restarting","Config seems to be valid, restarting...","success"),a.locked(!0)}).fail(ajaxAlertFail).fail()}catch(d){return c=d,swal("Oops...",c,"error")}}}(this))},b}();try{pimatic.pages.config=c=new b,ko.applyBindings(c,$("#config")[0])}catch(e){d=e,TraceKit.report(d)}}),$(document).on("pagehide","#config",function(){var a,b;try{if(a=pimatic.pages.config,null!=a.editor)return a.config(null)}catch(c){return b=c,TraceKit.report(b)}}),$(document).on("pageshow","#config",function(){var a,b;try{if(a=pimatic.pages.config,null!=a.editor&&null==a.config())return a.getConfig()}catch(c){return b=c,TraceKit.report(b)}})}).call(this);