(function(){$(document).on("pagebeforecreate",function(){var a,b;if(null==pimatic.pages.editDevice){a=function(){function a(){var a,b;this.pageTitle=ko.computed(function(a){return function(){return __("add"===a.action()?"Add New Device":"Edit Device")}}(this)),b=$("#device-json-editor"),a=null,this.deviceClass.subscribe(function(){return function(c){return null!=c?(console.log("change editor ",c),pimatic.client.rest.getDeviceConfigSchema({className:c}).done(function(d){var e;return e=d.configSchema,delete e.id,delete e.name,delete e["class"],null!=a&&a.destroy(),a=new JSONEditor(b[0],{disable_collapse:!0,disable_properties:!0,disable_edit_json:!0,theme:"jquerymobile",schema:{title:c,type:"object",properties:e}}),console.log(a)})):void 0}}(this))}return a.prototype.action=ko.observable("add"),a.prototype.deviceName=ko.observable(""),a.prototype.deviceId=ko.observable(""),a.prototype.deviceClass=ko.observable(""),a.prototype.deviceClasses=ko.observableArray(),a.prototype.resetFields=function(){return this.deviceName(""),this.deviceId(""),this.deviceClass("")},a.prototype.onSubmit=function(){var a;return a={deviceId:this.deviceId(),device:{name:this.deviceName()}},function(){switch(this.action()){case"add":return pimatic.client.rest.addDevice(a);case"update":return pimatic.client.resultt.updateDevice(a);default:throw new Error("Illegal devicedevice action: "+action())}}.call(this).done(function(a){return a.success?$.mobile.changePage("#index",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a.prototype.onRemove=function(){var a;return a=confirm(__("Do you really want to delete the %s device?",this.deviceName())),a&&pimatic.client.rest.removeDevice({deviceId:this.deviceId()}).done(function(a){return a.success?$.mobile.changePage("#index",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a}();try{pimatic.pages.editDevice=new a}catch(c){b=c,TraceKit.report(b)}}}),$(document).on("pagebeforeshow","#edit-device",function(){return pimatic.client.rest.getDeviceClasses({}).done(function(){return function(a){return a.success?pimatic.pages.editDevice.deviceClasses(a.deviceClasses):void 0}}(this))}),$(document).on("pagecreate","#edit-device",function(){var a;try{ko.applyBindings(pimatic.pages.editDevice,$("#edit-device")[0])}catch(b){a=b,TraceKit.report(a)}return $("#edit-device","#device-json-editor button",function(){return function(a){console.log(a),a.preventDefault()}}(this))})}).call(this);