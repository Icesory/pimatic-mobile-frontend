(function(){$(document).on("pagebeforecreate",function(){var a,b;if(null==pimatic.pages.editDevice){a=function(){function a(){var a,b;this.pageTitle=ko.computed(function(a){return function(){return __("add"===a.action()?"Add New Device":"Edit Device")}}(this)),a=$("#device-json-editor"),pimatic.autoFillId(this.deviceName,this.deviceId,this.action),b=function(a){return function(){var b,c,d,e,f;if(null!=a.editor){d=a.deviceConfig(),b={},c=0;for(e in d)f=d[e],"name"!==e&&"id"!==e&&"class"!==e&&(b[e]=f,c++);return console.log("confCopy:",b),0!==c?a.editor.setValue(b):void 0}}}(this),this.deviceClass.subscribe(function(c){return function(d){return null!=c.editor&&(c.editor.destroy(),c.editor=null),null!=d&&"string"==typeof d&&d.length>0?pimatic.client.rest.getDeviceConfigSchema({className:d}).done(function(d){var e;return null!=d.success?(e=d.configSchema,delete e.properties.id,delete e.properties.name,delete e.properties["class"],console.log("schema:",d.configSchema),c.editor=new JSONEditor(a[0],{disable_collapse:!0,disable_properties:!0,disable_edit_json:!0,theme:"jquerymobile",schema:e}),c.editor.on("ready",function(){return b(c.deviceConfig())})):void 0}):void 0}}(this))}return a.prototype.action=ko.observable("add"),a.prototype.deviceName=ko.observable(""),a.prototype.deviceId=ko.observable(""),a.prototype.deviceClass=ko.observable(""),a.prototype.deviceClasses=ko.observableArray(),a.prototype.deviceConfig=ko.observable({}),a.prototype.editor=null,a.prototype.resetFields=function(){return this.deviceName(""),this.deviceId(""),this.deviceConfig({}),this.deviceClass("")},a.prototype.onSubmit=function(){var a;return a=this.editor.getValue(),a.id=this.deviceId(),a.name=this.deviceName(),a["class"]=this.deviceClass(),function(){switch(this.action()){case"add":return pimatic.client.rest.addDeviceByConfig({deviceConfig:a});case"update":return pimatic.client.rest.updateDeviceByConfig({deviceConfig:a});default:throw new Error("Illegal devicedevice action: "+action())}}.call(this).done(function(a){return a.success?$.mobile.changePage("#devices-page",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a.prototype.onRemove=function(){var a;return a=confirm(__("Do you really want to delete the %s device?",this.deviceName())),a&&pimatic.client.rest.removeDevice({deviceId:this.deviceId()}).done(function(a){return a.success?$.mobile.changePage("#devices-page",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a}();try{pimatic.pages.editDevice=new a}catch(c){b=c,TraceKit.report(b)}}}),$(document).on("pagebeforeshow","#edit-device",function(){return pimatic.client.rest.getDeviceClasses({}).done(function(){return function(a){return a.success?pimatic.pages.editDevice.deviceClasses(a.deviceClasses):void 0}}(this))}),$(document).on("pagecreate","#edit-device",function(){var a;try{return ko.applyBindings(pimatic.pages.editDevice,$("#edit-device")[0])}catch(b){return a=b,TraceKit.report(a)}})}).call(this);