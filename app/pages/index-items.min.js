(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};$(document).on("pagebeforecreate",function(){var a,c,d,e,f,g,h,i,j,k,l,m,n;null==pimatic.templateClasses&&(n=$("#sortable-handle-template").text(),h=function(){function a(a){ko.mapping.fromJS(a,this.constructor.mapping,this)}return a.mapping={copy:["itemId","type","template"]},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a.prototype.afterRender=function(a){return $(a).addClass("item").find("label").before($(n))},a}(),g=function(a){function c(a){c.__super__.constructor.call(this,a)}return b(c,a),c.mapping={copy:h.mapping.copy.concat(["headerId","text"])},c}(h),a=function(a){function c(a){c.__super__.constructor.call(this,a)}return b(c,a),c.mapping={copy:h.mapping.copy.concat(["buttonId","text"])},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a)},c.prototype.onButtonPress=function(){return $.get("/button-pressed/"+this.buttonId).fail(ajaxAlertFail)},c}(h),m=function(a){function c(a){a.value||(a.value=null),c.__super__.constructor.call(this,a)}return b(c,a),c.mapping={copy:h.mapping.copy.concat(["name"]),observe:["value"]},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a)},c}(h),d=function(){function a(a){null==a.value&&(a.value=null),ko.mapping.fromJS(a,this.constructor.mapping,this),this.valueText=ko.computed(function(a){return function(){var b;return b=a.value(),null==b?__("unknown"):"boolean"===a.type?null==a.labels?b.toString():b===!0?a.labels[0]:b===!1?a.labels[1]:b.toString():b.toString()}}(this)),this.unitText=null!=this.unit?this.unit:""}return a.mapping={observe:["value"]},a}(),e=function(a){function c(a){c.__super__.constructor.call(this,a)}return b(c,a),c.mapping={attributes:{create:function(a){var b,c,e;return b=a.data,c=a.parent,e=a.skip,new d(b)},key:function(a){return a.name}},observe:["name","attributes"]},c.prototype.getAttribute=function(a){var b,c,d,e,f;for(c=null,f=this.attributes(),d=0,e=f.length;e>d;d++)if(b=f[d],b.name===a){c=b;break}return c},c.prototype.afterAttributeRender=function(a,b){return $(a).addClass("attr-"+b.name).addClass("attr-type-"+b.type).parent(".attributes").addClass("contains-attr-"+b.name).addClass("contains-attr-type-"+b.type)},c.prototype.updateAttribute=function(a,b){var c;return c=this.getAttribute(a),null!=c?c.value(b):void 0},c}(h),k=function(a){function c(a){c.__super__.constructor.call(this,a),this.switchId="switch-"+a.deviceId,this.switchState=ko.observable(this.getAttribute("state").value()?"on":"off"),this.getAttribute("state").value.subscribe(function(a){return function(b){return a.switchState(b?"on":"off"),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")})}}(this))}return b(c,a),c.prototype.onSwitchChange=function(){var a,b;return b="on"===this.switchState(),b!==this.getAttribute("state").value()?(this.sliderEle.flipswitch("disable"),a="on"===this.switchState()?"turnOn":"turnOff",pimatic.loading("switch-on-"+this.switchId,"show",{text:__("switching "+this.switchState())}),$.ajax("/api/device/"+this.deviceId+"/"+a,{global:!1}).done(ajaxShowToast).fail(function(a){return function(){return a.switchState("on"===a.switchState()?"off":"on"),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")})}}(this)).always(function(a){return function(){return pimatic.loading("switch-on-"+a.switchId,"hide"),pimatic["try"](function(){return a.sliderEle.flipswitch("enable")})}}(this)).fail(ajaxAlertFail)):void 0},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("select"),this.sliderEle.flipswitch()},c}(e),f=function(a){function c(a){var b;c.__super__.constructor.call(this,a),this.sliderId="switch-"+a.deviceId,b=this.getAttribute("dimlevel").value,this.sliderValue=ko.observable(null!=b()?b():0),this.getAttribute("dimlevel").value.subscribe(function(a){return function(b){return a.sliderValue(b),pimatic["try"](function(){return a.sliderEle.slider("refresh")})}}(this))}return b(c,a),c.prototype.onSliderStop=function(){return this.sliderEle.slider("disable"),pimatic.loading("dimming-"+this.sliderId,"show",{text:__("dimming to %s%",this.sliderValue())}),$.ajax("/api/device/"+this.deviceId+"/changeDimlevelTo",{data:{dimlevel:this.sliderValue()},global:!1}).done(ajaxShowToast).fail(function(a){return function(){return pimatic["try"](function(){return a.sliderEle.val(a.getAttribute("dimlevel").value()).slider("refresh")})}}(this)).always(function(a){return function(){return pimatic.loading("dimming-"+a.sliderId,"hide"),pimatic["try"](function(){return a.sliderEle.slider("enable")})}}(this)).fail(ajaxAlertFail)},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("input"),this.sliderEle.slider()},c}(e),l=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(e),i=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(e),c=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(e),j=function(a){function c(a){c.__super__.constructor.call(this,a),this.getAttribute("position").value.subscribe(function(a){return function(b){return a._updateButtons(b)}}(this))}return b(c,a),c.prototype.onShutterDownClicked=function(){return this._ajaxCall("down"===this.getAttribute("position").value()?"stop":"lowerDown")},c.prototype.onShutterUpClicked=function(){return this._ajaxCall("up"===this.getAttribute("position").value()?"stop":"liftUp")},c.prototype._ajaxCall=function(a){var b;return b=function(){switch(a){case"liftUp":return"moving up";case"lowerDown":return"moving down";case"stop":return"stopping"}}(),this.downBtn.addClass("ui-state-disabled"),this.upBtn.addClass("ui-state-disabled"),pimatic.loading("shutter-"+this.deviceId,"show",{text:__(b)}),$.ajax("/api/device/"+this.deviceId+"/"+a,{global:!1}).done(ajaxShowToast).always(function(a){return function(){return pimatic.loading("shutter-"+a.deviceId,"hide"),a.downBtn.removeClass("ui-state-disabled"),a.upBtn.removeClass("ui-state-disabled")}}(this)).fail(ajaxAlertFail)},c.prototype._updateButtons=function(a){switch(a){case"up":return this.downBtn.removeClass("ui-btn-active"),this.upBtn.addClass("ui-btn-active");case"down":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.addClass("ui-btn-active");case"stopped":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.removeClass("ui-btn-active")}},c.prototype.afterRender=function(a){var b;return c.__super__.afterRender.call(this,a),this.downBtn=$(a).find(".shutter-down"),this.upBtn=$(a).find(".shutter-up"),b=this.getAttribute("position").value(),null!=b?this._updateButtons(b):void 0},c}(e),pimatic.Item=h,pimatic.HeaderItem=g,pimatic.ButtonItem=a,pimatic.VariableItem=m,pimatic.DeviceItem=e,pimatic.SwitchItem=k,pimatic.DimmerItem=f,pimatic.TemperatureItem=l,pimatic.PresenceItem=i,pimatic.ShutterItem=j,pimatic.ContactItem=c,pimatic.templateClasses={header:pimatic.HeaderItem,button:pimatic.ButtonItem,variable:pimatic.VariableItem,device:pimatic.DeviceItem,"switch":pimatic.SwitchItem,dimmer:pimatic.DimmerItem,temperature:pimatic.TemperatureItem,presence:pimatic.PresenceItem,contact:pimatic.ContactItem,shutter:pimatic.ShutterItem})})}).call(this);