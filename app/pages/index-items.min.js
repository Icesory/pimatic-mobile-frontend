(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=function(a,b){return function(){return a.apply(b,arguments)}};$(document).on("pagebeforecreate",function(){var a,d,e,f,g,h,i,j,k,l,m,n;null==pimatic.templateClasses&&(n=$("#sortable-handle-template").text(),h=function(){function a(a){this.templData=a,ko.mapper.fromJS(a,this.constructor.mapping,this)}return a.prototype.update=function(a){return ko.mapper.fromJS(a,this.constructor.mapping,this)},a.prototype.afterRender=function(a){return $(a).addClass("item").find("label").before($(n))},a}(),g=function(a){function c(a){var b,c,d,e;if(0===a.length)this.title="Ungrouped";else for(this.title="",c=d=0,e=a.length;e>d;c=++d)b=a[c],0!==c&&(this.title+=", "),this.title+=b.name()}return b(c,a),c.prototype.afterRender=function(){},c.prototype.getItemTemplate=function(){return"header"},c}(h),e=function(a){function d(a,b){this.device=b,this.labelTooltipHtml=c(this.labelTooltipHtml,this),d.__super__.constructor.call(this,a),this.name=this.device.name,this.deviceId=this.device.id}return b(d,a),d.mapping={$default:"ignore",deviceId:"copy"},d.prototype.getAttribute=function(a){return this.device.getAttribute(a)},d.prototype.getItemTemplate=function(){return this.device.template},d.prototype.afterAttributeRender=function(a,b){var c;return c=$(a),c.addClass("attr-"+b.name).addClass("attr-type-"+b.type),c.parent(".attributes").addClass("contains-attr-"+b.name).addClass("contains-attr-type-"+b.type)},d.prototype.error=function(){return this.device===pimatic.nullDevice?"Could not find a device with id: "+this.templData.deviceId:null},d.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},d.prototype.labelTooltipHtml=function(){var a;return a="<div>ID: "+this.deviceId+"</div>\n<div>Class: "+this.device.config["class"]+"</div>",this.device.config.xLink&&(a+='<div><a href="'+this.device.config.xLink+'" target="_blank">Link</a></div>'),a},d}(h),l=function(a){function c(a,b){var d;if(this.device=b,c.__super__.constructor.call(this,a,this.device),this.switchId="switch-"+a.deviceId,d=this.getAttribute("state"),null==d)throw new Error("A switch device needs an state attribute!");this.switchState=ko.observable(d.value()?"on":"off"),d.value.subscribe(function(a){return function(b){return a.switchState(b?"on":"off"),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")})}}(this))}return b(c,a),c.prototype.onSwitchChange=function(){var a,b,c,d,e;return d="on"===this.switchState(),e=this.getAttribute("state").value(),d!==e?(this.sliderEle.flipswitch("disable"),a="on"===this.switchState()?"turnOn":"turnOff",b=this.device.config.xConfirm?confirm(__("Do you really want to turn %s "+this.switchState()+"? ",this.device.name())):!0,c="on"===this.switchState()?"off":"on",b?(pimatic.loading("switch-on-"+this.switchId,"show",{text:__("switching "+this.switchState())}),this.device.rest[a]({},{global:!1}).done(ajaxShowToast).fail(function(a){return function(){return a.switchState(c),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")})}}(this)).always(function(a){return function(){return pimatic.loading("switch-on-"+a.switchId,"hide"),pimatic["try"](function(){return a.sliderEle.flipswitch("enable")})}}(this)).fail(ajaxAlertFail)):(this.switchState(c),pimatic["try"](function(a){return function(){return a.sliderEle.flipswitch("enable")}}(this)),pimatic["try"](function(a){return function(){return a.sliderEle.flipswitch("refresh")}}(this)))):void 0},c.prototype.afterRender=function(a){var b,d;return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("select"),d=this.getAttribute("state"),null!=d.labels&&(b=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},this.sliderEle.find("option[value=on]").text(b(d.labels[0])),this.sliderEle.find("option[value=off]").text(b(d.labels[1]))),this.sliderEle.flipswitch(),$(a).find(".ui-flipswitch").addClass("no-carousel-slide")},c}(e),f=function(a){function c(a,b){var d;this.device=b,c.__super__.constructor.call(this,a,this.device),this.sliderId="switch-"+a.deviceId,d=this.getAttribute("dimlevel").value,this.sliderValue=ko.observable(null!=d()?d():0),this.getAttribute("dimlevel").value.subscribe(function(a){return function(b){return a.sliderValue(b),pimatic["try"](function(){return a.sliderEle.slider("refresh")})}}(this))}return b(c,a),c.prototype.onSliderStop=function(){return this.sliderEle.slider("disable"),pimatic.loading("dimming-"+this.sliderId,"show",{text:__("dimming to %s%",this.sliderValue())}),this.device.rest.changeDimlevelTo({dimlevel:this.sliderValue()},{global:!1}).done(ajaxShowToast).fail(function(a){return function(){return pimatic["try"](function(){return a.sliderEle.val(a.getAttribute("dimlevel").value()).slider("refresh")})}}(this)).always(function(a){return function(){return pimatic.loading("dimming-"+a.sliderId,"hide"),pimatic["try"](function(){return a.sliderEle.slider("enable")})}}(this)).fail(ajaxAlertFail)},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("input"),this.sliderEle.slider(),$(a).find(".ui-slider").addClass("no-carousel-slide")},c}(e),m=function(a){function d(){return this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d}(e),j=function(a){function d(a,b){this.device=b,this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.call(this,a,this.device),this.getAttribute("presence").value.subscribe(function(a){return function(){return a.updateClass()}}(this))}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d.prototype.afterRender=function(a){return d.__super__.afterRender.call(this,a),this.presenceEle=$(a).find(".attr-presence"),this.updateClass()},d.prototype.updateClass=function(){var a;if(a=this.getAttribute("presence").value(),null!=this.presenceEle)switch(a){case!0:this.presenceEle.addClass("value-present"),this.presenceEle.removeClass("value-absent");break;case!1:this.presenceEle.removeClass("value-present"),this.presenceEle.addClass("value-absent");break;default:this.presenceEle.removeClass("value-absent"),this.presenceEle.removeClass("value-present")}},d}(e),d=function(a){function d(){return this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d}(e),k=function(a){function c(a,b){this.device=b,c.__super__.constructor.call(this,a,this.device),this.getAttribute("position").value.subscribe(function(a){return function(b){return a._updateButtons(b)}}(this))}return b(c,a),c.prototype.onShutterDownClicked=function(){return this._ajaxCall("down"===this.getAttribute("position").value()?"stop":"moveDown")},c.prototype.onShutterUpClicked=function(){return this._ajaxCall("up"===this.getAttribute("position").value()?"stop":"moveUp")},c.prototype._ajaxCall=function(a){var b;return b=function(){switch(a){case"moveUp":return"moving up";case"moveDown":return"moving down";case"stop":return"stopping"}}(),this.downBtn.addClass("ui-state-disabled"),this.upBtn.addClass("ui-state-disabled"),pimatic.loading("shutter-"+this.deviceId,"show",{text:__(b)}),this.device.rest[a]({},{global:!1}).done(ajaxShowToast).always(function(a){return function(){return pimatic.loading("shutter-"+a.deviceId,"hide"),a.downBtn.removeClass("ui-state-disabled"),a.upBtn.removeClass("ui-state-disabled")}}(this)).fail(ajaxAlertFail)},c.prototype._updateButtons=function(a){if(null!=this.downBtn)switch(a){case"up":return this.downBtn.removeClass("ui-btn-active"),this.upBtn.addClass("ui-btn-active");case"down":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.addClass("ui-btn-active");case"stopped":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.removeClass("ui-btn-active")}},c.prototype.afterRender=function(a){var b;return c.__super__.afterRender.call(this,a),this.downBtn=$(a).find(".shutter-down"),this.upBtn=$(a).find(".shutter-up"),b=this.getAttribute("position").value(),null!=b?this._updateButtons(b):void 0},c}(e),a=function(a){function d(a,b){this.device=b,this.onButtonPress=c(this.onButtonPress,this),this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.call(this,a,this.device)}return b(d,a),d.prototype.getItemTemplate=function(){return"buttons"},d.prototype.onButtonPress=function(a){return this.device.rest.buttonPressed({buttonId:a.id},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail)},d}(e),i=function(a){function d(a,b){this.device=b,this.togglePlay=c(this.togglePlay,this),this.sendPlayerAction=c(this.sendPlayerAction,this),this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.call(this,a,this.device),this.currentTitle=this.device.getAttribute("currentTitle").value,this.playButtonIcon=ko.computed(function(a){return function(){var b;return b=a.device.getAttribute("state").value,"play"===b()?"pause":"play"}}(this))}return b(d,a),d.prototype.getItemTemplate=function(){return"musicplayer"},d.prototype.sendPlayerAction=function(a){return this.device.rest[a]({}).done(ajaxShowToast).fail(ajaxAlertFail)},d.prototype.togglePlay=function(){var a,b;return b=this.device.getAttribute("state").value,a="play"===b()?"pause":"play",this.sendPlayerAction(a)},d}(e),pimatic.Item=h,pimatic.HeaderItem=g,pimatic.ButtonsItem=a,pimatic.DeviceItem=e,pimatic.SwitchItem=l,pimatic.DimmerItem=f,pimatic.TemperatureItem=m,pimatic.PresenceItem=j,pimatic.ShutterItem=k,pimatic.ContactItem=d,pimatic.MuscicplayerItem=i,pimatic.templateClasses={"null":pimatic.DeviceItem,header:pimatic.HeaderItem,buttons:pimatic.ButtonsItem,variable:pimatic.VariableItem,device:pimatic.DeviceItem,"switch":pimatic.SwitchItem,dimmer:pimatic.DimmerItem,temperature:pimatic.TemperatureItem,presence:pimatic.PresenceItem,contact:pimatic.ContactItem,shutter:pimatic.ShutterItem,musicplayer:pimatic.MuscicplayerItem},$(document).trigger("templateinit",[]),$(document).trigger("templateready",[]))})}).call(this);