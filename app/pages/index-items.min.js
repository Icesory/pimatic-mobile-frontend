(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=function(a,b){return function(){return a.apply(b,arguments)}};$(document).on("pagebeforecreate",function(){var a,d,e,f,g,h,i,j,k,l;null==pimatic.templateClasses&&(l=$("#sortable-handle-template").text(),g=function(){function a(a){this.templData=a,ko.mapping.fromJS(a,this.constructor.mapping,this)}return a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a.prototype.afterRender=function(a){return $(a).addClass("item").find("label").before($(l))},a}(),f=function(a){function c(a){var b,c,d,e;if(0===a.length)this.title="Ungrouped";else for(this.title="",c=d=0,e=a.length;e>d;c=++d)b=a[c],0!==c&&(this.title+=", "),this.title+=b.name()}return b(c,a),c.prototype.afterRender=function(){},c.prototype.getItemTemplate=function(){return"header"},c}(g),d=function(a){function c(a,b){this.device=b,c.__super__.constructor.call(this,a),this.name=this.device.name,this.deviceId=this.device.id}return b(c,a),c.mapping={copy:["deviceId"]},c.prototype.getAttribute=function(a){return this.device.getAttribute(a)},c.prototype.getItemTemplate=function(){return this.device.template},c.prototype.afterAttributeRender=function(a,b){return $(a).addClass("attr-"+b.name).addClass("attr-type-"+b.type).parent(".attributes").addClass("contains-attr-"+b.name).addClass("contains-attr-type-"+b.type)},c.prototype.error=function(){return this.deive===pimatic.nullDevice?"Could not find a device with id: "+this.templData.deviceId:null},c}(g),j=function(a){function c(a,b){this.device=b,c.__super__.constructor.call(this,a,this.device),this.switchId="switch-"+a.deviceId,this.switchState=ko.observable(this.getAttribute("state").value()?"on":"off"),this.getAttribute("state").value.subscribe(function(a){return function(b){return a.switchState(b?"on":"off"),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")})}}(this))}return b(c,a),c.prototype.onSwitchChange=function(){var a,b;return b="on"===this.switchState(),b!==this.getAttribute("state").value()?(this.sliderEle.flipswitch("disable"),a="on"===this.switchState()?"turnOn":"turnOff",pimatic.loading("switch-on-"+this.switchId,"show",{text:__("switching "+this.switchState())}),this.device.rest[a]({},{global:!1}).done(ajaxShowToast).fail(function(a){return function(){return a.switchState("on"===a.switchState()?"off":"on"),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")})}}(this)).always(function(a){return function(){return pimatic.loading("switch-on-"+a.switchId,"hide"),pimatic["try"](function(){return a.sliderEle.flipswitch("enable")})}}(this)).fail(ajaxAlertFail)):void 0},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("select"),this.sliderEle.flipswitch(),$(a).find(".ui-flipswitch").addClass("no-carousel-slide")},c}(d),e=function(a){function c(a,b){var d;this.device=b,c.__super__.constructor.call(this,a,this.device),this.sliderId="switch-"+a.deviceId,d=this.getAttribute("dimlevel").value,this.sliderValue=ko.observable(null!=d()?d():0),this.getAttribute("dimlevel").value.subscribe(function(a){return function(b){return a.sliderValue(b),pimatic["try"](function(){return a.sliderEle.slider("refresh")})}}(this))}return b(c,a),c.prototype.onSliderStop=function(){return this.sliderEle.slider("disable"),pimatic.loading("dimming-"+this.sliderId,"show",{text:__("dimming to %s%",this.sliderValue())}),this.device.rest.changeDimlevelTo({dimlevel:this.sliderValue()},{global:!1}).done(ajaxShowToast).fail(function(a){return function(){return pimatic["try"](function(){return a.sliderEle.val(a.getAttribute("dimlevel").value()).slider("refresh")})}}(this)).always(function(a){return function(){return pimatic.loading("dimming-"+a.sliderId,"hide"),pimatic["try"](function(){return a.sliderEle.slider("enable")})}}(this)).fail(ajaxAlertFail)},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("input"),this.sliderEle.slider(),$(a).find(".ui-slider").addClass("no-carousel-slide")},c}(d),k=function(a){function d(){return this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d}(d),h=function(a){function d(){return this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d}(d),a=function(a){function d(){return this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d}(d),i=function(a){function c(a,b){this.device=b,c.__super__.constructor.call(this,a,this.device),this.getAttribute("position").value.subscribe(function(a){return function(b){return a._updateButtons(b)}}(this))}return b(c,a),c.prototype.onShutterDownClicked=function(){return this._ajaxCall("down"===this.getAttribute("position").value()?"stop":"moveDown")},c.prototype.onShutterUpClicked=function(){return this._ajaxCall("up"===this.getAttribute("position").value()?"stop":"moveUp")},c.prototype._ajaxCall=function(a){var b;return b=function(){switch(a){case"moveUp":return"moving up";case"moveDown":return"moving down";case"stop":return"stopping"}}(),this.downBtn.addClass("ui-state-disabled"),this.upBtn.addClass("ui-state-disabled"),pimatic.loading("shutter-"+this.deviceId,"show",{text:__(b)}),this.device.rest[a]({},{global:!1}).done(ajaxShowToast).always(function(a){return function(){return pimatic.loading("shutter-"+a.deviceId,"hide"),a.downBtn.removeClass("ui-state-disabled"),a.upBtn.removeClass("ui-state-disabled")}}(this)).fail(ajaxAlertFail)},c.prototype._updateButtons=function(a){switch(a){case"up":return this.downBtn.removeClass("ui-btn-active"),this.upBtn.addClass("ui-btn-active");case"down":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.addClass("ui-btn-active");case"stopped":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.removeClass("ui-btn-active")}},c.prototype.afterRender=function(a){var b;return c.__super__.afterRender.call(this,a),this.downBtn=$(a).find(".shutter-down"),this.upBtn=$(a).find(".shutter-up"),b=this.getAttribute("position").value(),null!=b?this._updateButtons(b):void 0},c}(d),pimatic.Item=g,pimatic.HeaderItem=f,pimatic.DeviceItem=d,pimatic.SwitchItem=j,pimatic.DimmerItem=e,pimatic.TemperatureItem=k,pimatic.PresenceItem=h,pimatic.ShutterItem=i,pimatic.ContactItem=a,pimatic.templateClasses={"null":pimatic.DeviceItem,header:pimatic.HeaderItem,button:pimatic.ButtonItem,variable:pimatic.VariableItem,device:pimatic.DeviceItem,"switch":pimatic.SwitchItem,dimmer:pimatic.DimmerItem,temperature:pimatic.TemperatureItem,presence:pimatic.PresenceItem,contact:pimatic.ContactItem,shutter:pimatic.ShutterItem},$(document).trigger("templateinit",[]))})}).call(this);