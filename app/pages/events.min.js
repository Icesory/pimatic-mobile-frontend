(function(){var a;a=pimatic.tryCatch,$(document).on("pagecreate","#events",a(function(){var b,c,d,e;b=function(){function a(a){this.data=a,this.device=ko.computed(function(){return function(){return pimatic.getDeviceById(a.deviceId)}}(this)).extend({rateLimit:{timeout:10,method:"notifyAtFixedRate"}}),this.attribute=ko.computed(function(b){return function(){return null!=b.device()?b.device().getAttribute(a.attributeName):null}}(this))}return a.prototype.formatedTime=function(){var a,b,c,d;return c=function(){return function(a){return 10>a?"0"+a:""+a}}(this),a=new Date(this.data.time),b=c(a.getDate())+"."+c(a.getMonth()+1)+"."+a.getFullYear(),d=c(a.getHours())+":"+c(a.getMinutes())+":"+c(a.getSeconds()),'<span class="date">'+b+'</span> \n<span class="time">'+d+"</span>"},a.prototype.formatedValue=function(){return null!=this.attribute()?this.attribute().formatValue(this.data.value):this.data.value},a.prototype.formatedDeviceName=function(){return null!=this.device()?'<span class="device-name">'+this.device().name()+'</span> \n<span class="device-id">('+this.data.deviceId+")</span>":this.data.deviceId},a.prototype.formatedAttributeName=function(){return null!=this.attribute()?this.attribute().label:this.data.attributeName},a}(),c=function(){function c(){pimatic.devices(),this.updateFromJs([]),this.displayedEvents=ko.computed(function(a){return function(){var b,c,d;return d=a.events(),b=function(){var a,b,e;for(e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c);return e}()}}(this)).extend({rateLimit:{timeout:10,method:"notifyAtFixedRate"}}),ko.computed(function(a){return function(){return a.loadEvents()}}(this)),this.updateListView=ko.computed(function(a){return function(){return a.displayedEvents(),pimatic["try"](function(){return $("#events-table").table("refresh")})}}(this)).extend({rateLimit:{timeout:10,method:"notifyAtFixedRate"}})}return c.mapping={events:{create:function(a){var c,d,e;return c=a.data,d=a.parent,e=a.skip,new b(c)},key:function(a){return""+a.time+"-"+a.deviceId+"-"+a.attributeName}},ignore:["success"]},c.prototype.updateFromJs=function(a){return ko.mapping.fromJS({events:a},c.mapping,this)},c.prototype.loadEvents=function(){var b;return b=function(b){return function(){var c;if(null==b.loadEventsAjax)return pimatic.loading("loading events","show",{text:__("Loading Events")}),c={limit:100},pimatic.client.rest.queryDeviceAttributeEvents({criteria:c}).always(function(){return pimatic.loading("loading events","hide")}).done(a(function(a){console.log("loading done"),b.loadEventsAjax=null,a.success&&b.updateFromJs(a.events)})).fail(ajaxAlertFail)}}(this),null==this.loadEventsAjax?b():this.loadEventsAjax.done(function(){return function(){return b()}}(this))},c}();try{pimatic.pages.events=e=new c,ko.applyBindings(e,$("#events")[0])}catch(f){d=f,TraceKit.report(d)}})),$(document).on("pagebeforeshow","#events",a(function(){var a;try{return pimatic.pages.events.loadEvents()}catch(b){return a=b,TraceKit.report(a)}}))}).call(this);