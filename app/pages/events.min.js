(function(){var a;a=pimatic.tryCatch,$(document).on("pagecreate","#events",a(function(){var b,c,d;b=function(){function b(){this.updateFromJs([]),this.displayedEvents=ko.computed(function(a){return function(){var b,c,d;return d=a.events(),b=function(){var a,b,e;for(e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c);return e}()}}(this)).extend({rateLimit:{timeout:10,method:"notifyAtFixedRate"}}),ko.computed(function(a){return function(){return a.loadEvents()}}(this)),this.updateListView=ko.computed(function(a){return function(){return a.displayedEvents(),$("#events-table").table("refresh")}}(this))}return b.mapping={events:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,b},key:function(a){return""+a.time+"-"+a.deviceId+"-"+a.attributeName}},ignore:["success"]},b.prototype.updateFromJs=function(a){return ko.mapping.fromJS({events:a},b.mapping,this)},b.prototype.loadEvents=function(){var b;return b=function(b){return function(){var c;if(null==b.loadEventsAjax)return pimatic.loading("loading events","show",{text:__("Loading Events")}),c={limit:100},b.loadEventsAjax=$.ajax("/api/database/queryDeviceAttributeEvents",{global:!1,data:{criteria:c}}).always(function(){return pimatic.loading("loading events","hide")}).done(a(function(a){b.loadEventsAjax=null,a.success&&b.updateFromJs(a.events)})).fail(ajaxAlertFail)}}(this),null==this.loadEventsAjax?b():this.loadEventsAjax.done(function(){return function(){return b()}}(this))},b.prototype.formatTime=function(a){var b,c,d;return d=function(){return function(a){return 10>a?"0"+a:""+a}}(this),b=new Date(a),c=d(b.getDate())+"."+d(b.getMonth()+1)+"."+b.getFullYear(),a=d(b.getHours())+":"+d(b.getMinutes())+":"+d(b.getSeconds()),""+c+" "+a},b}();try{pimatic.pages.events=d=new b,ko.applyBindings(d,$("#events")[0])}catch(e){c=e,TraceKit.report(c)}})),$(document).on("pagebeforeshow","#events",a(function(){var a;try{return pimatic.pages.events.loadEvents()}catch(b){return a=b,TraceKit.report(a)}}))}).call(this);