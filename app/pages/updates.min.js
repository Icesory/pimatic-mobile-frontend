(function(){$(document).on("pagebeforeshow","#updates",function(){return $("#updates #install-updates").hide(),$("#updates .restart-now").hide()}),$(document).on("pageshow","#updates",function(){var a;return a=pimatic.pages.updates,a.searchForPimaticUpdate().done(function(){return a.searchForOutdatedPlugins().done(function(){return a.pimaticUpdate!==!1||0!==a.outdatedPlugins.length?$("#install-updates").show():void 0})})}),$(document).on("pagecreate","#updates",function(){return $("#updates").on("click","#install-updates",function(){var a,b,c;return c=pimatic.pages.updates,a=c.pimaticUpdate?["pimatic"]:[],a=a.concat(function(){var a,d,e,f;for(e=c.outdatedPlugins,f=[],a=0,d=e.length;d>a;a++)b=e[a],f.push(b.plugin);return f}()),$.ajax({url:"/api/update",type:"POST",data:{modules:a},timeout:1e6}).done(function(a){return $("#updates #install-updates").hide(),a.success?($("#updates .message").append($("<p>")).text(__("Updates were successful. Please restart pimatic.")),$("#updates .restart-now").show()):void 0}).fail(ajaxAlertFail)}),$("#updates").on("click",".restart-now",function(){return $.get("/api/restart").fail(ajaxAlertFail)})}),pimatic.pages.updates={outdatedPlugins:null,pimaticUpdate:null,searchForPimaticUpdate:function(){return $("#updates .message").text(__("pimatic is searching for updates...")),$.ajax({url:"/api/outdated/pimatic",timeout:3e5}).done(function(a){$("#updates .message").text(""),$("#updates .message").append(a.isOutdated===!1?$("<p>").text(__("pimatic is up to date.")):$("<p>").text(__("Found update for %s: current version is %s, latest version is: %s","pimatic",a.isOutdated.current,a.isOutdated.latest))),pimatic.pages.updates.pimaticUpdate=a.isOutdated}).fail(ajaxAlertFail)},searchForOutdatedPlugins:function(){return $.ajax({url:"/api/outdated/plugins",timeout:3e5}).done(function(a){var b,c,d,e;if(0===a.outdated.length)$("#updates .message").append($("<p>").text(__("All plugins are up to date")));else for(e=a.outdated,c=0,d=e.length;d>c;c++)b=e[c],$("#updates .message").append($("<p>").text(__("Found update for %s: current version is %s, latest version is: %s",b.plugin,b.current,b.latest)));pimatic.pages.updates.outdatedPlugins=a.outdated}).fail(ajaxAlertFail)}}}).call(this);