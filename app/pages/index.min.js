(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=pimatic.tryCatch,$(document).on("pagecreate","#index",a(function(){var c,d,e,f;c=function(){function c(){this.onDropItemOnTrash=b(this.onDropItemOnTrash,this),this.onItemsSorted=b(this.onItemsSorted,this),this.toggleEditing=b(this.toggleEditing,this),this.onAddItemClicked=b(this.onAddItemClicked,this),this.onEditPageClicked=b(this.onEditPageClicked,this),this.onAddPageClicked=b(this.onAddPageClicked,this),this.onPageTabClicked=b(this.onPageTabClicked,this),this.showDevicePage=b(this.showDevicePage,this),this.getItemTemplate=b(this.getItemTemplate,this);var c,d,e;if(this.groups=pimatic.groups,this.rememberme=pimatic.rememberme,this.updateFromJs({ruleItemCssClass:"",hasRootCACert:!1}),this.lockButton=ko.computed(a(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this))),this.devicepagesTabsRefresh=ko.computed(a(function(a){return function(){var b,c,d,e,f;if(a.bindingsApplied())return b=a.devicepages(),c=a.enabledEditing(),f=$("#item-tabs"),pimatic["try"](function(){return f.navbar("destroy")}),ko.cleanNode(f[0]),e=b.length>0?"<ul data-bind=\"foreach: devicepages\">\n  <li>\n    <a \n      data-ajax='false' \n      data-bind=\"attr: {\n        href: '#item-tab-'+$data.id}, \n        text: name, \n        css: {'ui-btn-active': $data == $root.activeDevicepage()}, \n        click: $root.onPageTabClicked\"\n    ></a>\n  </li>\n</ul>":"<ul></ul>",f.html(e),ko.applyBindings(a,f[0]),d=$("#edit-handle-template").text(),f.find("li a").each(function(){return $(this).prepend($(d))}),c&&f.find("ul").append('<li><a data-ajax="false" href="#edit-devicepage" id="add-devicepage-link">'+__("Add a Page...")+"</a></li>"),b.length>0||a.enabledEditing()?f.navbar():void 0}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),e=[],ko.computed(a(function(a){return function(){var b,c,d,f,g,h,i,j,k,l;if(a.bindingsApplied()){for(d=a.devicepages(),f=ko.utils.compareArrays(d,e),e=function(){var a,b,c;for(c=[],a=0,b=d.length;b>a;a++)j=d[a],c.push(j);return c}(),b=!1,k=0,l=f.length;l>k;k++)if(c=f[k],"retained"!==c.status){b=!0;break}b&&(h=$("#item-lists"),ko.cleanNode(h[0]),i=h.data("owlCarousel"),null!=i&&i.destroy(),d.length>0?(g=$("#devicepages-template").text(),h.html(g),null!=ko.dataFor($("#index")[0])&&ko.applyBindings(a,h[0]),h.find('[data-role="listview"]').listview(),h.owlCarousel({navigation:!0,slideSpeed:300,paginationSpeed:400,singleItem:!0,pagination:!1,navigation:!1,lazyEffect:!1,lazyLoad:!1,afterAction:function(){},afterMove:function(b){var c;return c=b.data("owlCarousel").currentItem,a.activeDevicepage(a.devicepages()[c])}})):h.html(""))}}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.activeDevicepage.subscribe(function(a){return function(b){var c,d;if(null!=b&&(d=$("#item-lists").data("owlCarousel"),null!=d&&(c=a.devicepages.indexOf(b),-1!==c)))return d.goTo(c)}}(this)),ko.computed(function(a){return function(){var b;return b=a.devicepages(),0===b.length?a.activeDevicepage(null):null==a.activeDevicepage()?a.activeDevicepage(b[0]):void 0}}(this)),this.itemsListViewRefresh=ko.computed(a(function(a){return function(){var b,c,d,e,f,g,h,i;for(h=a.devicepages(),d=0,f=h.length;f>d;d++)b=h[d],b.devices();for(i=pimatic.groups(),e=0,g=i.length;g>e;e++)c=i[e],c.devices();return a.isSortingItems(),a.enabledEditing(),pimatic["try"](function(){return $('#item-lists [data-role="listview"]').each(function(){var a;return a=$(this),null==a.data("mobileListview")?a.listview():a.listview("refresh")})})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.deviepagesRefresh=ko.computed(a(function(a){return function(){return a.devicepages(),pimatic["try"](function(){return $(".nav-panel-menu").listview("refresh")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),pimatic.storage.isSet("pimatic.indexPage")){c=pimatic.storage.get("pimatic.indexPage");try{this.updateFromJs(c)}catch(f){d=f,TraceKit.report(d),pimatic.storage.removeAll(),window.location.reload()}}this.autosave=ko.computed(function(a){return function(){return c=ko.mapping.toJS(a),pimatic.storage.set("pimatic.indexPage",c)}}(this)).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),this.toggleEditingText=ko.computed(a(function(a){return function(){return __(a.enabledEditing()?"Lock lists":"Edit lists")}}(this)))}return c.mapping={},c.prototype.devicepages=pimatic.devicepages,c.prototype.errorCount=pimatic.errorCount,c.prototype.activeDevicepage=ko.observable(null),c.prototype.isSortingItems=ko.observable(!1),c.prototype.enabledEditing=ko.observable(!1),c.prototype.bindingsApplied=ko.observable(!1),c.prototype.getItemTemplate=function(a){return""+a.getItemTemplate()+"-template"},c.prototype.showDevicePage=function(a){return this.activeDevicepage(a),$("#nav-panel").panel("close"),!0},c.prototype.updateFromJs=function(a){return ko.mapping.fromJS(a,c.mapping,this)},c.prototype.onPageTabClicked=function(a){return this.activeDevicepage(a)},c.prototype.onAddPageClicked=function(){return pimatic.pages.editDevicepage.resetFields(),pimatic.pages.editDevicepage.action("add"),!0},c.prototype.onEditPageClicked=function(a){return pimatic.pages.editDevicepage.pageId(a.id),pimatic.pages.editDevicepage.pageName(a.name()),pimatic.pages.editDevicepage.action("update"),jQuery.mobile.changePage("#edit-devicepage"),!0},c.prototype.onAddItemClicked=function(){return!0},c.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing()),pimatic.loading("enableediting","show",{text:__("Saving")}),$.ajax("/enabledEditing/"+this.enabledEditing(),{global:!1}).always(function(){return pimatic.loading("enableediting","hide")}).done(ajaxShowToast)},c.prototype.onItemsSorted=function(a,b){var c,d,e,f,g,h;return c=function(){return function(b,c){var d,e;return e=null==c?0:ko.utils.arrayIndexOf(b.devices(),c.device.id)+1,-1===e&&(e=0),d=b.id,pimatic.client.rest.addDeviceToGroup({deviceId:a.device.id,groupId:d,position:e}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),g=function(){return function(b){var c;return c=b.id,pimatic.client.rest.removeDeviceFromGroup({deviceId:a.device.id,groupId:c}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),h=function(b){return function(c){var d,e,f,g,h;for(d=[],null==c&&d.push(a.device.id),h=b.activeDevicepage().devices(),f=0,g=h.length;g>f;f++)e=h[f],e!==a&&(d.push(e.device.id),null!=c&&e===c&&d.push(a.device.id));return pimatic.client.rest.updatePage({pageId:b.activeDevicepage().id,page:{devicesOrder:d}}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),null!=b?(d=b instanceof pimatic.DeviceItem?b.device.group():b.group instanceof pimatic.Group?b.group:null,f=b instanceof pimatic.DeviceItem?b:void 0,e=a.device.group(),d!==e?null!=d?(c(d,f),h(f)):null!=e?(g(e),h(f)):h(f):h(f)):void 0},c.prototype.onDropItemOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete the item?")),c?(b=function(b){return function(){var c;return c=b.activeDevicepage(),pimatic.loading("deleteitem","show",{text:__("Saving")}),pimatic.client.rest.removeDeviceFromPage({deviceId:a.deviceId,pageId:c.id}).always(function(){return pimatic.loading("deleteitem","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},c.prototype.toLoginPage=function(){var a;return a=encodeURIComponent(window.location.href),window.location.href="/login?url="+a},c}(),pimatic.pages.index=e=new c;try{ko.applyBindings(e,$("#index")[0]),e.bindingsApplied(!0)}catch(g){d=g,TraceKit.report(d),null!=(f=pimatic.storage)&&f.removeAll(),window.location.reload()}$("#index").on("change","#item-lists .switch",a(function(){var a;a=ko.dataFor(this),a.onSwitchChange()})),$("#index").on("slidestop"," #item-lists .dimmer",a(function(){var a;a=ko.dataFor(this),a.onSliderStop()})),$("#index").on("vclick","#item-lists .shutter-down",a(function(){var a;return a=ko.dataFor(this),a.onShutterDownClicked(),!1})),$("#index").on("vclick","#item-lists .shutter-up",a(function(){var a;return a=ko.dataFor(this),a.onShutterUpClicked(),!1})),$("#index").on("vclick","#item-tabs .edit-handle",a(function(){return e.onEditPageClicked(ko.dataFor(this)),!1})),$("#index").on("vclick","#item-tabs #add-devicepage-link",a(function(){return e.onAddPageClicked(),!0})),$("#items .handle").disableSelection(),$("#nav-panel").on("panelopen panelclose",a(function(){var a;return a=$("#item-lists"),a.is(":visible")?pimatic["try"](function(){return function(){return a.data("owlCarousel").reload()}}(this)):void 0}))})),$(document).on("click",".content-overlay",a(function(){return $("#nav-panel").panel("close")})),$(document).on("pageshow","#index",a(function(){return pimatic["try"](function(){return function(){return $("#item-lists").data("owlCarousel").reload()}}(this))})),$(document).on("pagebeforeshow","#index",a(function(){return setTimeout(function(){return pimatic["try"](function(){return function(){return $("#nav-panel").find('[data-role="listview"]').listview("refresh")}}(this)),pimatic["try"](function(){return function(){return $("#item-lists").find('[data-role="listview"]').listview("refresh")}}(this)),pimatic["try"](function(){return function(){return $("#item-tabs").navbar()}}(this))},2)}))}).call(this);