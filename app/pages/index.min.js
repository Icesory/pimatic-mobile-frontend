(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=pimatic.tryCatch,$(document).on("pagebeforecreate",a(function(){var c,d;null==pimatic.pages.index&&(c=function(){function c(){this.onPageTabClicked=b(this.onPageTabClicked,this);var c,d,e;if(this.updateFromJs({errorCount:0,enabledEditing:!1,rememberme:!1,showAttributeVars:!1,ruleItemCssClass:"",hasRootCACert:!1,updateProcessStatus:"idle",updateProcessMessages:[]}),this.updateProcessStatus.subscribe(a(function(){return function(a){switch(a){case"running":return pimatic.loading("update-process-status","show",{text:__("Installing updates, Please be patient")});default:return pimatic.loading("update-process-status","hide")}}}(this))),this.setupStorage(),this.lockButton=ko.computed(a(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this))),this.devicepagesTabsRefresh=ko.computed(a(function(a){return function(){var b,c,d;return b=a.devicepages(),d=$("#item-tabs"),pimatic["try"](function(){return d.navbar("destroy")}),ko.cleanNode(d[0]),b.length>0?(c="<ul data-bind=\"foreach: devicepages\">\n  <li>\n    <a data-ajax='false' data-bind=\"attr: {href: '#item-tab-'+$data.id}, text: name, css: {'ui-btn-active': $data.isActive}, click: $root.onPageTabClicked\"></a>\n  </li>\n</ul>",d.html(c),ko.applyBindings(a,d[0]),$("#item-tabs").navbar()):d.html("")}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.devicepagesTabsRefresh=ko.computed(a(function(a){return function(){var b,c,d,e,f,g,h,i,j,k,l;if(b=a.devicepages(),e=$("#item-lists"),ko.cleanNode(e[0]),f=e.data("owlCarousel"),null!=f&&f.destroy(),b.length>0){for(c="",d=i=0,k=b.length;k>i;d=++i)g=b[d],c+='<div>\n  <ul data-role="listview" data-pageid="'+g.id+'" class="items">\n  <!-- ko template: { name: $root.getItemTemplate, foreach: devicepages()['+d+"].devices, afterRender: devicepages()["+d+"].afterRender } --><!-- /ko -->\n  </ul>\n</div>";for(e.html(c),j=0,l=b.length;l>j;j++)g=b[j],h=e.find("ul[data-pageid="+g.id+"]");return ko.applyBindings(a,e[0]),e.find('[data-role="listview"]').listview(),e.owlCarousel({navigation:!0,slideSpeed:300,paginationSpeed:400,singleItem:!0,pagination:!1,navigation:!1,afterAction:function(){return e.trigger("updatelayout")},afterMove:function(b){var c;return c=b.data("owlCarousel").currentItem,a.activeDevicepage(a.devicepages()[c])}})}return e.html("")}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.activeDevicepage.subscribe(function(a){return function(b){var c,d;if(null!=b&&(d=$("#item-lists").data("owlCarousel"),null!=d&&(c=a.devicepages.indexOf(b),-1!==c)))return d.goTo(c)}}(this)),this.devicepages.subscribe(function(a){return function(b){return 0===b.length?a.activeDevicepage(null):null==a.activeDevicepage()?a.activeDevicepage(b[0]):void 0}}(this)),this.itemsListViewRefresh=ko.computed(a(function(a){return function(){var b,c,d,e;for(e=a.devicepages(),c=0,d=e.length;d>c;c++)b=e[c],b.devices();return a.isSortingItems(),a.enabledEditing(),pimatic["try"](function(){return $('#item-lists [data-role="listview"]').each(function(){var a;return a=$(this),null==a.data("mobileListview")?a.listview():a.listview("refresh").addClass("dark-background")})})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.deviepagesRefresh=ko.computed(a(function(a){return function(){return a.devicepages(),pimatic["try"](function(){return $(".nav-panel-menu").listview("refresh").addClass("dark-background")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),pimatic.storage.isSet("pimatic.indexPage")){c=pimatic.storage.get("pimatic.indexPage");try{this.updateFromJs(c)}catch(f){d=f,TraceKit.report(d),pimatic.storage.removeAll(),window.location.reload()}}this.autosave=ko.computed(function(a){return function(){return c=ko.mapping.toJS(a),pimatic.storage.set("pimatic.indexPage",c)}}(this)).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),e=!0,this.rememberme.subscribe(a(function(a){return function(b){var c;return e?$.get("remember",{rememberMe:b}).done(ajaxShowToast).fail(function(){return e=!1,a.rememberme(!b)}).fail(ajaxAlertFail):e=!0,c=pimatic.storage.get("pimatic"),pimatic.storage.removeAll(),pimatic.storage=b?$.localStorage:$.sessionStorage,pimatic.storage.set("pimatic",c)}}(this))),this.toggleEditingText=ko.computed(a(function(a){return function(){return __(a.enabledEditing()?"Lock lists":"Edit lists")}}(this)))}return c.mapping={},c.prototype.devicepages=pimatic.devicepages,c.prototype.activeDevicepage=ko.observable(null),c.prototype.isSortingItems=ko.observable(!1),c.prototype.getItemTemplate=function(a){return""+a.getItemTemplate()+"-template"},c.prototype.setupStorage=function(){return $.localStorage.isSet("pimatic")?(pimatic.storage=$.localStorage,$.sessionStorage.removeAll(),this.rememberme(!0)):$.sessionStorage.isSet("pimatic")?(pimatic.storage=$.sessionStorage,$.localStorage.removeAll(),this.rememberme(!1)):(pimatic.storage=$.sessionStorage,this.rememberme(!1),pimatic.storage.set("pimatic",{}))},c.prototype.updateFromJs=function(a){return ko.mapping.fromJS(a,c.mapping,this)},c.prototype.onPageTabClicked=function(a){return this.activeDevicepage(a)},c.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing()),pimatic.loading("enableediting","show",{text:__("Saving")}),$.ajax("/enabledEditing/"+this.enabledEditing(),{global:!1}).always(function(){return pimatic.loading("enableediting","hide")}).done(ajaxShowToast)},c.prototype.onItemsSorted=function(){var a,b;return b=function(){var b,c,d,e;for(d=this.items(),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.itemId);return e}.call(this),pimatic.loading("itemorder","show",{text:__("Saving")}),$.ajax("update-item-order",{type:"POST",global:!1,data:{order:b}}).always(function(){return pimatic.loading("itemorder","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)},c.prototype.onDropItemOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete the item?")),c?(b=function(b){return function(){return pimatic.loading("deleteitem","show",{text:__("Saving")}),$.post("remove-item",{itemId:a.itemId}).done(function(c){return c.success?b.items.remove(a):void 0}).always(function(){return pimatic.loading("deleteitem","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},c.prototype.toLoginPage=function(){var a;return a=encodeURIComponent(window.location.href),window.location.href="/login?url="+a},c}(),pimatic.pages.index=d=new c,pimatic.socket.on("welcome",a(function(a){return d.updateFromJs(a)})),pimatic.socket.on("device-attribute",a(function(a){return d.updateDeviceAttribute(a.id,a.name,a.value)})),pimatic.socket.on("variable",a(function(a){return d.updateVariable(a)})),pimatic.socket.on("item-add",a(function(a){return d.addItemFromJs(a)})),pimatic.socket.on("item-remove",a(function(a){return d.removeItem(a)})),pimatic.socket.on("item-order",a(function(a){return d.updateItemOrder(a)})),pimatic.socket.on("rule-add",a(function(a){return d.updateRuleFromJs(a)})),pimatic.socket.on("rule-update",a(function(a){return d.updateRuleFromJs(a)})),pimatic.socket.on("rule-remove",a(function(a){return d.removeRule(a)})),pimatic.socket.on("rule-order",a(function(a){return d.updateRuleOrder(a)})),pimatic.socket.on("variable-add",a(function(a){return d.addVariableFromJs(a)})),pimatic.socket.on("variable-remove",a(function(a){return d.removeVariable(a)})),pimatic.socket.on("variable-order",a(function(a){return d.updateVariableOrder(a)})),pimatic.socket.on("update-process-status",a(function(a){return d.updateProcessStatus(a)})),pimatic.socket.on("update-process-message",a(function(a){return d.updateProcessMessages.push(a)})),pimatic.socket.on("log",a(function(a){return"error"===a.level?d.errorCount(d.errorCount()+1):void 0})))})),$(document).on("pagecreate","#index",a(function(){var b,c,d;c=pimatic.pages.index;try{ko.applyBindings(c,$("#index")[0])}catch(e){b=e,TraceKit.report(b),null!=(d=pimatic.storage)&&d.removeAll(),window.location.reload()}$("#index #items").on("change",".switch",a(function(){var a;a=ko.dataFor(this),a.onSwitchChange()})),$("#index #items").on("slidestop",".dimmer",a(function(){var a;a=ko.dataFor(this),a.onSliderStop()})),$("#index #items").on("vclick",".shutter-down",a(function(){var a;return a=ko.dataFor(this),a.onShutterDownClicked(),!1})),$("#index #items").on("vclick",".shutter-up",a(function(){var a;return a=ko.dataFor(this),a.onShutterUpClicked(),!1})),$("#items .handle").disableSelection()}))}).call(this);