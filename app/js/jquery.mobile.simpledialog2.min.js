!function(a){a.widget("mobile.simpledialog2",a.mobile.widget,{options:{version:"1.0.1-2012061300",mode:"blank",themeDialog:"b",themeInput:!1,themeButtonDefault:!1,themeHeader:"a",fullScreen:!1,fullScreenForce:!1,dialogAllow:!1,dialogForce:!1,headerText:!1,headerClose:!1,buttonPrompt:!1,buttonInput:!1,buttonInputDefault:!1,buttonPassword:!1,blankContent:!1,blankContentAdopt:!1,resizeListener:!0,safeNuke:!0,forceInput:!0,showModal:!0,animate:!0,transition:"pop",clickEvent:"click",zindex:"500",width:"280px",left:!1,top:!1,callbackOpen:!1,callbackOpenArgs:[],callbackClose:!1,callbackCloseArgs:[]},_eventHandler:function(a,b){{var c=a.data.widget;a.data.widget.options}if(!a.isPropagationStopped())switch(b.method){case"close":c.close();break;case"html":c.updateBlank(b.source)}},_create:function(){var b=this,c=a.extend(this.options,this.element.jqmData("options")),d=new Date,e=a("<div class='ui-simpledialog-container ui-overlay-shadow ui-corner-all ui-simpledialog-hidden "+(c.animate===!0?c.transition:"")+" ui-body-"+c.themeDialog+"'></div>");c.themeButtonDefault===!1&&(c.themeButtonDefault=c.themeDialog),c.themeInput===!1&&(c.themeInput=c.themeDialog),a.mobile.sdCurrentDialog=b,"undefined"!=typeof a.mobile.sdLastInput&&delete a.mobile.sdLastInput,b.internalID=d.getTime(),b.displayAnchor=a.mobile.activePage.children(".ui-content").first(),0===b.displayAnchor.length&&(b.displayAnchor=a.mobile.activePage),b.dialogPage=a("<div data-role='dialog' data-theme='"+c.themeDialog+"'><div data-role='header'></div><div data-role='content'></div></div>"),b.sdAllContent=b.dialogPage.find("[data-role=content]"),e.appendTo(b.sdAllContent),b.sdIntContent=b.sdAllContent.find(".ui-simpledialog-container"),b.sdIntContent.css("width",c.width),(c.headerText!==!1||c.headerClose!==!1)&&(b.sdHeader=a('<div style="margin-bottom: 4px;" class="ui-header ui-bar-'+c.themeHeader+'"></div>'),c.headerClose===!0&&a("<a class='ui-btn-left' rel='close' href='#'>Close</a>").appendTo(b.sdHeader).buttonMarkup({theme:c.themeHeader,icon:"delete",iconpos:"notext",corners:!0,shadow:!0}),a('<h1 class="ui-title">'+(c.headerText!==!1?c.headerText:"")+"</h1>").appendTo(b.sdHeader),b.sdHeader.appendTo(b.sdIntContent)),"blank"===c.mode?(c.blankContent===!0&&(c.blankContent=c.blankContentAdopt===!0?b.element.children():b.element.html()),a(c.blankContent).appendTo(b.sdIntContent)):"button"===c.mode&&b._makeButtons().appendTo(b.sdIntContent),b.sdIntContent.appendTo(b.displayAnchor.parent()),b.dialogPage.appendTo(a.mobile.pageContainer).page().css("minHeight","0px").css("zIndex",c.zindex),c.animate===!0&&b.dialogPage.addClass(c.transition),b.screen=a("<div>",{"class":"ui-simpledialog-screen ui-simpledialog-hidden"}).css("z-index",c.zindex-1).appendTo(b.displayAnchor.parent()).bind(c.clickEvent,function(a){c.forceInput||b.close(),a.preventDefault()}),c.showModal&&b.screen.addClass("ui-simpledialog-screen-modal"),a(document).bind("simpledialog."+b.internalID,{widget:b},function(a,c){b._eventHandler(a,c)})},_makeButtons:function(){var b=this,c=b.options,d=a("<div></div>"),e=a("<div class='ui-simpledialog-controls'><input class='ui-simpledialog-input ui-input-text ui-shadow-inset ui-corner-all ui-body-"+c.themeInput+"' type='"+(c.buttonPassword===!0?"password":"text")+"' value='"+(c.buttonInputDefault!==!1?c.buttonInputDefault.replace('"',"&#34;").replace("'","&#39;"):"")+"' name='pickin' /></div>"),f=a("<div>",{"class":"ui-simpledialog-controls"});return c.buttonPrompt!==!1&&(b.buttonPromptText=a("<p class='ui-simpledialog-subtitle'>"+c.buttonPrompt+"</p>").appendTo(d)),c.buttonInput!==!1&&(a.mobile.sdLastInput="",e.appendTo(d),e.find("input").bind("change",function(){a.mobile.sdLastInput=e.find("input").first().val(),b.thisInput=e.find("input").first().val()})),f.appendTo(d),b.butObj=[],a.each(c.buttons,function(d,e){e=a.isFunction(e)?{click:e}:e,e=a.extend({text:d,id:d+b.internalID,theme:c.themeButtonDefault,icon:"check",iconpos:"left",corners:"true",shadow:"true",args:[],close:!0},e),b.butObj.push(a("<a href='#'>"+e.text+"</a>").appendTo(f).attr("id",e.id).buttonMarkup({theme:e.theme,icon:e.icon,iconpos:e.iconpos,corners:e.corners,shadow:e.shadow}).unbind("vclick click").bind(c.clickEvent,function(){c.buttonInput&&b.sdIntContent.find("input [name=pickin]").trigger("change");var d=e.click.apply(b,a.merge(arguments,e.args));d!==!1&&e.close===!0&&b.close()}))}),d},_getCoords:function(b){var c=a.mobile.activePage.width(),d=a(window).scrollTop(),e=a(window).height(),f=b.sdIntContent.innerWidth(),g=b.sdIntContent.outerHeight(),h={high:a(window).height(),width:a.mobile.activePage.width(),fullTop:a(window).scrollTop(),fullLeft:a(window).scrollLeft(),winTop:d+(b.options.top!==!1?b.options.top:e/2-g/2),winLeft:b.options.left!==!1?b.options.left:c/2-f/2};return h.winTop<45&&(h.winTop=45),h},_orientChange:function(a){var b=a.data.widget,c=a.data.widget.options,d=a.data.widget._getCoords(a.data.widget);return a.stopPropagation(),b.isDialog===!0?!0:void(c.fullScreen===!0&&(d.width<400||c.fullScreenForce===!0)?b.sdIntContent.css({border:"none",position:"absolute",top:d.fullTop,left:d.fullLeft,height:d.high,width:d.width,maxWidth:d.width}).removeClass("ui-simpledialog-hidden"):b.sdIntContent.css({position:"absolute",top:d.winTop,left:d.winLeft}).removeClass("ui-simpledialog-hidden"))},repos:function(){var a={data:{widget:this},stopPropagation:function(){return!0}};this._orientChange(a)},open:function(){var b=this,c=this.options,d=this._getCoords(this);b.sdAllContent.find(".ui-btn-active").removeClass("ui-btn-active"),b.sdIntContent.delegate("[rel=close]",c.clickEvent,function(a){a.preventDefault(),b.close()}),c.dialogAllow===!0&&d.width<400||c.dialogForce?(b.isDialog=!0,"blank"===c.mode&&b.sdIntContent.find("select").each(function(){a(this).jqmData("nativeMenu",!0)}),b.displayAnchor.parent().unbind("pagehide.remove"),b.sdAllContent.append(b.sdIntContent),b.sdAllContent.trigger("create"),c.headerText!==!1&&(b.sdHeader.find("h1").appendTo(b.dialogPage.find("[data-role=header]")),b.sdIntContent.find(".ui-header").empty().removeClass()),c.headerClose===!0?b.dialogPage.find(".ui-header a").bind("click",function(){setTimeout("$.mobile.sdCurrentDialog.destroy();",1e3)}):b.dialogPage.find(".ui-header a").remove(),b.sdIntContent.removeClass().css({top:"auto",width:"auto",left:"auto",marginLeft:"auto",marginRight:"auto",zIndex:c.zindex}),a.mobile.changePage(b.dialogPage,{transition:c.animate===!0?c.transition:"none"})):(b.isDialog=!1,b.selects=[],c.fullScreen===!1&&(c.showModal===!0&&c.animate===!0?b.screen.fadeIn("slow"):b.screen.removeClass("ui-simpledialog-hidden")),b.sdIntContent.addClass("ui-overlay-shadow in").css("zIndex",c.zindex).trigger("create"),c.fullScreen===!0&&(d.width<400||c.fullScreenForce===!0)?b.sdIntContent.removeClass("ui-simpledialog-container").css({border:"none",position:"absolute",top:d.fullTop,left:d.fullLeft,height:d.high,width:d.width,maxWidth:d.width}).removeClass("ui-simpledialog-hidden"):b.sdIntContent.css({position:"absolute",top:d.winTop,left:d.winLeft}).removeClass("ui-simpledialog-hidden"),a(document).bind("orientationchange.simpledialog",{widget:b},function(a){b._orientChange(a)}),c.resizeListener===!0&&a(window).bind("resize.simpledialog",{widget:b},function(a){b._orientChange(a)})),a.isFunction(c.callbackOpen)&&c.callbackOpen.apply(b,c.callbackOpenArgs)},close:function(){var b,c=this,d=this.options;return a.isFunction(c.options.callbackClose)&&(b=c.options.callbackClose.apply(c,c.options.callbackCloseArgs),b===!1)?!1:(c.isDialog?(a(c.dialogPage).dialog("close"),c.sdIntContent.addClass("ui-simpledialog-hidden"),c.sdIntContent.appendTo(c.displayAnchor.parent()),1!=a.mobile.activePage.jqmData("page").options.domCache&&a.mobile.activePage.is(":jqmData(external-page='true')")&&a.mobile.activePage.bind("pagehide.remove",function(){a(this).remove()})):(c.options.showModal===!0&&c.options.animate===!0?c.screen.fadeOut("slow"):c.screen.addClass("ui-simpledialog-hidden"),c.sdIntContent.addClass("ui-simpledialog-hidden").removeClass("in"),a(document).unbind("orientationchange.simpledialog"),c.options.resizeListener===!0&&a(window).unbind("resize.simpledialog")),"blank"===d.mode&&d.blankContent!==!1&&d.blankContentAdopt===!0&&(c.element.append(d.blankContent),d.blankContent=!0),void(c.isDialog===!0||c.options.animate===!0?setTimeout(function(a){return function(){a.destroy()}}(c),1e3):c.destroy()))},destroy:function(){var b=this,c=b.element;"blank"===b.options.mode&&a.mobile.sdCurrentDialog.sdIntContent.find("select").each(function(){0==a(this).data("nativeMenu")&&(a(this).data("selectmenu").menuPage.remove(),a(this).data("selectmenu").screen.remove(),a(this).data("selectmenu").listbox.remove())}),a(b.sdIntContent).remove(),a(b.dialogPage).remove(),a(b.screen).remove(),a(document).unbind("simpledialog."+b.internalID),delete a.mobile.sdCurrentDialog,a.Widget.prototype.destroy.call(b),b.options.safeNuke===!0&&0===a(c).parents().length&&0===a(c).contents().length&&c.remove()},updateBlank:function(b){var c=this,d=this.options;c.sdIntContent.empty(),(d.headerText!==!1||d.headerClose!==!1)&&(c.sdHeader=a('<div class="ui-header ui-bar-'+d.themeHeader+'"></div>'),d.headerClose===!0&&a("<a class='ui-btn-left' rel='close' href='#'>Close</a>").appendTo(c.sdHeader).buttonMarkup({theme:d.themeHeader,icon:"delete",iconpos:"notext",corners:!0,shadow:!0}),a('<h1 class="ui-title">'+(d.headerText!==!1?d.headerText:"")+"</h1>").appendTo(c.sdHeader),c.sdHeader.appendTo(c.sdIntContent)),a(b).appendTo(c.sdIntContent),c.sdIntContent.trigger("create"),a(document).trigger("orientationchange.simpledialog")},_init:function(){this.open()}})}(jQuery);