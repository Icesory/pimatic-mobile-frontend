(function(){var a,b,c,d,e,f;b=function(){function a(a){null==a.value&&(a.value=null),ko.mapping.fromJS(a,this.constructor.mapping,this),this.valueText=ko.computed(function(a){return function(){var b;return b=a.value(),null==b?__("unknown"):"boolean"===a.type?null==a.labels?b.toString():b===!0?a.labels[0]:b===!1?a.labels[1]:b.toString():b.toString()}}(this)),this.unitText=null!=this.unit?this.unit:""}return a.mapping={observe:["value"]},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a}(),a=function(){function a(a){ko.mapping.fromJS(a,this.constructor.mapping,this)}return a.mapping={attributes:{create:function(a){var c,d,e;return c=a.data,d=a.parent,e=a.skip,new b(c)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.name}},observe:["name","attributes"]},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a.prototype.getAttribute=function(a){return ko.utils.arrayFirst(this.attributes(),function(){return function(b){return b.name===a}}(this))},a.prototype.updateAttribute=function(a,b){var c;return c=this.getAttribute(a),null!=c?c.value(b):void 0},a}(),e=function(){function a(a){ko.mapping.fromJS(a,this.constructor.mapping,this)}return a.mapping={key:function(a){return a.id},copy:["id"]},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a}(),f=function(){function a(a){null==a.value&&(a.value=null),null==a.exprInputStr&&(a.exprInputStr=null),null==a.exprTokens&&(a.exprTokens=null),ko.mapping.fromJS(a,this.constructor.mapping,this),this.displayName=ko.computed(function(a){return function(){return"$"+a.name}}(this)),this.hasValue=ko.computed(function(a){return function(){return null!=a.value()}}(this)),this.displayValue=ko.computed(function(a){return function(){return a.hasValue()?a.value():"null"}}(this))}return a.mapping={key:function(a){return a.name},observe:["value","type","exprInputStr","exprTokens"]},a.prototype.isDeviceAttribute=function(){return-1!==$.inArray(".",this.name)},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a}(),c=function(){function a(a){ko.mapping.fromJS(a,this.constructor.mapping,this),this.isActive=ko.computed(function(a){return function(){return null==pimatic.pages.index?!1:pimatic.pages.index.activeDevicepage()===a}}(this))}return a.mapping={key:function(a){return a.id},copy:["id"],devices:{create:function(a){var b,c,d,e,f;return b=a.data,e=a.parent,f=a.skip,c=pimatic.getDeviceById(b.deviceId),null==c&&(c=pimatic.nullDevice),d=pimatic.templateClasses[c.template],null==d&&(console.warn("Could not find a template class for "+b.template),d=pimatic.DeviceItem),null==c?console.error("Device should never be null"):new d(b,c)},key:function(a){return a.name}}},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a.prototype.getDeviceTemplate=function(a){return a.getDeviceTemplate()},a.prototype.afterRenderDevice=function(a,b){return b.afterRender(a)},a}(),d=function(){function b(a){this.updateFromJs(a)}return b.mapping={devices:{create:function(b){var c,d,e;return c=b.data,d=b.parent,e=b.skip,new a(c)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.id}},rules:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,new e(b)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.id}},variables:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,new f(b)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.name}},devicepages:{create:function(a){var b,d,e;return b=a.data,d=a.parent,e=a.skip,new c(b)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.id}}},b.prototype.socket=null,b.prototype.inited=!1,b.prototype.pages={},b.prototype.storage=null,b.prototype.nullDevice=new a({id:"null",name:"null",attributes:[],template:"null"}),b.prototype.updateFromJs=function(a){return ko.mapping.fromJS(a,b.mapping,this)},b.prototype.getDeviceById=function(a){return ko.utils.arrayFirst(this.devices(),function(){return function(b){return b.id===a}}(this))},b.prototype.updateDeviceAttribute=function(a,b,c){var d,e,f,g,h;for(g=this.devices(),h=[],e=0,f=g.length;f>e;e++){if(d=g[e],d.id===a){d.updateAttribute(b,c);break}h.push(void 0)}return h},b.prototype.updatePageFromJs=function(a){var b,c,d,e,f;for(e=this.devicepages(),f=[],c=0,d=e.length;d>c;c++){if(b=e[c],b.id===a.id){b.update(a);break}f.push(void 0)}return f},b.prototype.getPageById=function(a){return ko.utils.arrayFirst(this.devicepages(),function(){return function(b){return b.id===a}}(this))},b.prototype.removePage=function(a){return this.devicepages.remove(function(){return function(b){return b.id===a}}(this))},b.prototype.updatePageFromJs=function(a){var c;return c=this.getPageById(a.id),null==c?(c=b.mapping.devicepages.create({data:a}),this.devicepages.push(c)):c.update(a)},b.prototype.getRuleById=function(a){return ko.utils.arrayFirst(this.rules(),function(){return function(b){return b.id===a}}(this))},b.prototype.removeRule=function(a){return this.rules.remove(function(){return function(b){return b.id===a}}(this))},b.prototype.updateRuleFromJs=function(a){var c;return c=this.getRuleById(a.id),null==c?(c=b.mapping.devicerules.create({data:a}),this.devicerules.push(c)):c.update(a)},b.prototype.removeVariable=function(a){return this.variables.remove(function(){return function(b){return b.name===a}}(this))},b.prototype.getVariableByName=function(a){return ko.utils.arrayFirst(this.variables(),function(){return function(b){return b.name===a}}(this))},b.prototype.updateVariableFromJs=function(a){var c;return c=this.getVariableById(a.name),null==c?(c=b.mapping.devicevariables.create({data:a}),this.devicevariables.push(c)):c.update(a)},b}(),window.pimatic=new d({devices:[],rules:[],variables:[],devicepages:[]})}).call(this);