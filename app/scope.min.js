(function(){var a,b,c,d,e,f;b=function(){function a(a){null==a.value&&(a.value=null),ko.mapping.fromJS(a,this.constructor.mapping,this),this.valueText=ko.computed(function(a){return function(){var b;return b=a.value(),null==b?__("unknown"):"boolean"===a.type?null==a.labels?b.toString():b===!0?a.labels[0]:b===!1?a.labels[1]:b.toString():b.toString()}}(this)),this.unitText=null!=this.unit?this.unit:""}return a.mapping={observe:["value"]},a}(),a=function(){function a(a){ko.mapping.fromJS(a,this.constructor.mapping,this)}return a.mapping={attributes:{create:function(a){var c,d,e;return c=a.data,d=a.parent,e=a.skip,new b(c)},key:function(a){return a.name}},observe:["name","attributes"]},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a.prototype.getAttribute=function(a){var b,c,d,e,f;for(c=null,f=this.attributes(),d=0,e=f.length;e>d;d++)if(b=f[d],b.name===a){c=b;break}return c},a.prototype.updateAttribute=function(a,b){var c;return c=this.getAttribute(a),null!=c?c.value(b):void 0},a}(),e=function(){function a(a){ko.mapping.fromJS(a,this.constructor.mapping,this)}return a.mapping={key:function(a){return a.id},copy:["id"]},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a}(),f=function(){function a(a){null==a.value&&(a.value=null),null==a.exprInputStr&&(a.exprInputStr=null),null==a.exprTokens&&(a.exprTokens=null),ko.mapping.fromJS(a,this.constructor.mapping,this),this.displayName=ko.computed(function(a){return function(){return"$"+a.name}}(this)),this.hasValue=ko.computed(function(a){return function(){return null!=a.value()}}(this)),this.displayValue=ko.computed(function(a){return function(){return a.hasValue()?a.value():"null"}}(this))}return a.mapping={key:function(a){return a.name},observe:["value","type","exprInputStr","exprTokens"]},a.prototype.isDeviceAttribute=function(){return-1!==$.inArray(".",this.name)},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a}(),c=function(){function a(a){ko.mapping.fromJS(a,this.constructor.mapping,this),this.isActive=ko.computed(function(a){return function(){return null==pimatic.pages.index?!1:pimatic.pages.index.activeDevicepage()===a}}(this))}return a.mapping={key:function(a){return a.id},copy:["id"],devices:{create:function(a){var b,c,d,e,f;return b=a.data,e=a.parent,f=a.skip,c=pimatic.getDeviceById(b.deviceId),null==c&&(c=pimatic.nullDevice),d=pimatic.templateClasses[c.template],null==d&&(console.warn("Could not find a template class for "+b.template),d=pimatic.DeviceItem),null==c?console.error("Device should never be null"):new d(b,c)},key:function(a){return a.name}}},a.prototype.update=function(a){return ko.mapping.fromJS(a,this.constructor.mapping,this)},a.prototype.getDeviceTemplate=function(a){return a.getDeviceTemplate()},a}(),d=function(){function b(a){this.updateFromJs(a)}return b.mapping={devices:{create:function(b){var c,d,e;return c=b.data,d=b.parent,e=b.skip,new a(c)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.id}},rules:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,new e(b)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.id}},variables:{create:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.skip,new f(b)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.name}},devicepages:{create:function(a){var b,d,e;return b=a.data,d=a.parent,e=a.skip,new c(b)},update:function(a){var b,c,d;return b=a.data,c=a.parent,d=a.target,d.update(b),d},key:function(a){return a.id}}},b.prototype.socket=null,b.prototype.inited=!1,b.prototype.pages={},b.prototype.storage=null,b.prototype.nullDevice=new a({id:"null",name:"null",attributes:[],template:"null"}),b.prototype.updateFromJs=function(a){return ko.mapping.fromJS(a,b.mapping,this)},b.prototype.getDeviceById=function(a){return ko.utils.arrayFirst(this.devices(),function(){return function(b){return b.id===a}}(this))},b}(),window.pimatic=new d({devices:[],rules:[],variables:[],devicepages:[]})}).call(this);